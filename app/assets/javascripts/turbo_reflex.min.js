var f={};addEventListener("turbo:before-fetch-response",e=>{let t=e.target;f[t.id]=t.src,delete t.dataset.turboReflexActive});addEventListener("turbo:frame-load",e=>{let t=e.target;t.dataset.turboReflexSrc=f[t.id]||t.src||t.dataset.turboReflexSrc,delete f[t.id]});addEventListener("turbo:before-stream-render",e=>{let r=e.target.templateContent.querySelector("turbo-frame");if(!r)return;let s=r.id;setTimeout(()=>{let n=document.getElementById(s);n.dataset.turboReflexSrc=f[r.id]||n.src||n.dataset.turboReflexSrc,delete f[s]},100)});var h={get token(){return document.getElementById("turbo-reflex-token").getAttribute("content")}},d=h;function l(e){return e.closest("[data-turbo-reflex]")}function E(e){return e.closest("turbo-frame")}function m(e){let t=e.dataset.turboReflexFrame||e.dataset.turboFrame;if(!t){let r=E(e);r&&(t=r.id)}return t||console.error("The reflex element does not specify a frame!","Please move the reflex element inside a <turbo-frame> or set the 'data-turbo-reflex-frame' or 'data-turbo-frame' attribute.",e),t}function b(e){let t=document.getElementById(e);return t||console.error(`The frame '${e}' does not exist!`),t}function x(e){let t=e.dataset.turboReflexSrc||e.src;return t||console.error(`The the 'src' for frame '${e.id}' is unknown!`,"TurboReflex uses 'src' to (re)render frame content after the reflex is invoked.","Please set the 'src' or 'data-turbo-reflex-src' attribute on the <turbo-frame> element.",e),t}function p(e){let{tagName:t,value:r}=e,s=t.toLowerCase(),n=Array.from(e.attributes).reduce((a,o)=>(a[o.name]=o.value,a),{});return n.tagName=t,n.value=r||null,s==="select"&&(e.multiple?n.values=Array.from(e.options).reduce((a,o)=>(o.selected&&a.push(o.value),a),[]):n.value=e.options[e.selectedIndex].value),s==="input"&&e.type==="checkbox"&&(n.checked=!!e.checked),n}var i={},c;function g(e){c=e}function u(e,t){i[e]=t,document.removeEventListener(e,c,!0),document.addEventListener(e,c,!0)}function v(e,t){return t=t.toLowerCase(),i[e].includes(t)||!Object.values(i).flat().includes(t)&&i[e].includes("*")}addEventListener("turbo:before-fetch-request",e=>{let t=e.target,{turboReflexActive:r}=t.dataset;if(!r)return;let{fetchOptions:s}=e.detail;s.headers["Turbo-Reflex"]=d.token});function R(e){let t=document.createElement("a");return t.href=e,new URL(t)}function y(e){let t=l(e.target);if(!t||!v(e.type,t.tagName))return;let r=m(t);if(!r)return;let s=b(r);if(!s)return;let n=x(s);if(!n)return;let a={frameId:r,element:p(t)};if(s.dataset.turboReflexActive=!0,t.tagName.toLowerCase()==="form"){let o=document.createElement("input");o.type="hidden",o.name="turbo_reflex",o.value=JSON.stringify(a),t.appendChild(o)}else{e.preventDefault(),e.stopPropagation();let o=R(n);o.searchParams.set("turbo_reflex",JSON.stringify(a)),s.src=o.toString()}}g(y);u("change",["input","select","textarea"]);u("submit",["form"]);u("click",["*"]);var T={registeredEvents:i,registerEvent:u};export{T as default};
//# sourceMappingURL=turbo_reflex.min.js.map
