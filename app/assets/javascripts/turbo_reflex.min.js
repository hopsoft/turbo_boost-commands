var s={},u={};addEventListener("turbo:before-fetch-request",e=>{let t=e.target,{turboReflexActive:r}=t.dataset;if(r){let{fetchOptions:o}=e.detail;o.headers["Turbo-Reflex"]=e.target.id}});addEventListener("turbo:before-fetch-response",e=>{let t=e.target;u[t.id]=t.src,delete t.dataset.turboReflexActive});addEventListener("turbo:frame-load",e=>{let t=e.target;t.dataset.turboReflexSrc=u[t.id]||t.src||t.dataset.turboReflexSrc,delete u[t.id]});addEventListener("turbo:before-stream-render",e=>{let r=e.target.templateContent.querySelector("turbo-frame");if(!r)return;let o=r.id;setTimeout(()=>{let n=document.getElementById(o);n.dataset.turboReflexSrc=u[r.id]||n.src||n.dataset.turboReflexSrc,delete u[o]},100)});function d(e,t){return t=t.toLowerCase(),s[e].includes(t)||!Object.values(s).flat().includes(t)&&s[e].includes("*")}function l(e){let t=e.dataset.turboReflexFrame||e.dataset.turboFrame;if(!t){let r=e.closest("turbo-frame");r&&(t=r.id)}return t||console.error("The reflex element does not specify a frame!","Please move the reflex element inside a <turbo-frame> or set the 'data-turbo-reflex-frame' or 'data-turbo-frame' attribute.",e),t}function m(e){let t=document.getElementById(e);return t||console.error(`The frame '${e}' does not exist!`),t}function b(e){let t=e.dataset.turboReflexSrc||e.src;return t||console.error(`The the 'src' for frame '${e.id}' is unknown!`,"TurboReflex uses 'src' to (re)render frame content after the reflex is invoked.","Please set the 'src' or 'data-turbo-reflex-src' attribute on the <turbo-frame> element.",e),t}function g(){return document.getElementById("turbo-reflex-token").getAttribute("content")}function h(e){let t=document.createElement("a");return t.href=e,new URL(t)}function p(e){let t=Array.from(e.attributes).reduce((r,o)=>(o.name.includes("data-turbo-reflex")||(r[o.name]=o.value),r),{});return t.tagName=e.tagName,t.value=e.value,e.tagName.toLowerCase()==="select"&&(e.multiple?t.values=Array.from(e.options).reduce((r,o)=>(o.selected&&r.push(o.value),r),[]):t.value=e.options[e.selectedIndex].value),e.tagName.toLowerCase()==="input"&&e.type==="checkbox"&&(t.checked=!!e.checked),t}function i(e){let t=e.target.closest("[data-turbo-reflex]");if(!t||!d(e.type,t.tagName))return;let r=l(t);if(!r)return;let o=m(r);if(!o)return;let n=b(o);if(!n)return;let f={token:g(),name:t.dataset.turboReflex,frame:r,element:p(t)};if(o.dataset.turboReflexActive=!0,t.tagName.toLowerCase()==="form"){let a=document.createElement("input");a.type="hidden",a.name="turbo_reflex",a.value=JSON.stringify(f),t.appendChild(a)}else{e.preventDefault(),e.stopPropagation();let a=h(n);a.searchParams.set("turbo_reflex",JSON.stringify(f)),o.src=a.toString()}}function c(e,t){s[e]=t,document.removeEventListener(e,i,!0),document.addEventListener(e,i,!0)}c("change",["input","select","textarea"]);c("submit",["form"]);c("click",["*"]);var x={registerEvent:c,registeredEvents:s};export{x as default};
//# sourceMappingURL=turbo_reflex.min.js.map
