var ft=Object.defineProperty,pt=Object.defineProperties;var bt=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var gt=Object.prototype.hasOwnProperty,ht=Object.prototype.propertyIsEnumerable;var U=(t,e,r)=>e in t?ft(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,s=(t,e)=>{for(var r in e||(e={}))gt.call(e,r)&&U(t,r,e[r]);if(H)for(var r of H(e))ht.call(e,r)&&U(t,r,e[r]);return t},b=(t,e)=>pt(t,bt(e));var vt="TurboBoost-Command",v={boost:"text/vnd.turbo-boost.html",stream:"text/vnd.turbo-stream.html",html:"text/html",xhtml:"application/xhtml+xml",json:"application/json"},Et=(t={})=>{t=s({},t);let e=(t.Accept||"").split(",").map(r=>r.trim()).filter(r=>r.length);return e.unshift(v.boost,v.stream,v.html,v.xhtml),t.Accept=[...new Set(e)].join(", "),t["Content-Type"]=v.json,t["X-Requested-With"]="XMLHttpRequest",t},yt=t=>{if(t){let[e,r,o]=t.split(", ");return{name:e,status:r,strategy:o}}return{}},p={prepare:Et,tokenize:yt,RESPONSE_HEADER:vt};var St=t=>{document.body.insertAdjacentHTML("beforeend",t)},At=t=>{let r=new DOMParser().parseFromString(t,"text/html");TurboBoost.Streams.morph.method(document.documentElement,r.documentElement)},S=(t,e)=>{if(t&&e){if(t.match(/^Append$/i))return St(e);if(t.match(/^Replace$/i))return At(e)}};var $={};addEventListener("turbo:before-fetch-response",t=>{let e=t.target.closest("turbo-frame");e!=null&&e.id&&(e!=null&&e.src)&&($[e.id]=e.src);let{fetchResponse:r}=t.detail,o=r.header(p.RESPONSE_HEADER);if(!o)return;t.preventDefault();let{strategy:n}=p.tokenize(o);r.responseHTML.then(d=>S(n,d))});addEventListener("turbo:frame-load",t=>{let e=t.target.closest("turbo-frame");e.dataset.src=$[e.id]||e.src||e.dataset.src,delete $[e.id]});var Ct={frameAttribute:"data-turbo-frame",methodAttribute:"data-turbo-method",commandAttribute:"data-turbo-command",confirmAttribute:"data-turbo-confirm",pageStateAttribute:"data-retain"},i=s({},Ct);var a={start:"turbo-boost:command:start",success:"turbo-boost:command:success",finish:"turbo-boost:command:finish",abort:"turbo-boost:command:abort",clientError:"turbo-boost:command:client-error",serverError:"turbo-boost:command:server-error"},m={pageChange:"turbo-boost:state:page-change",stateChange:"turbo-boost:state:change",stateInitialize:"turbo-boost:state:initialize"},P={load:"turbo:load",frameLoad:"turbo:frame-load"},be=s(s({},a),m);function c(t,e,r={}){return new Promise(o=>{r=r||{},r.detail=r.detail||{},e=e||document;let n=new CustomEvent(t,b(s({},r),{bubbles:!0}));e.dispatchEvent(n),o(n)})}var A={};function xt(t){A[t.id]=t}function kt(t){delete A[t]}var C={add:xt,remove:kt,get commands(){return[...Object.values(A)]},get length(){return Object.keys(A).length}};var V={method:t=>Promise.resolve(confirm(t))},Lt=t=>t.detail.driver==="method",wt=t=>{if(t.detail.driver!=="form")return!1;let e=t.target,r=e.closest("turbo-frame"),o=e.closest(`[${i.frameAttribute}]`);return!!(r||o)},Ot=t=>Lt(t)||wt(t);document.addEventListener(a.start,async t=>{let e=t.target.getAttribute(i.confirmAttribute);if(!e||(t.detail.confirmation=!0,Ot(t)))return;await V.method(e)||t.preventDefault()});var W=V;var f=[],_;function Tt(t,e){let r=f.find(o=>o.name===t);return r&&f.splice(f.indexOf(r),1),f=[{name:t,selectors:e},...f],document.removeEventListener(t,_,!0),document.addEventListener(t,_,!0),s({},f.find(o=>o.name===t))}function Rt(t){return f.find(e=>e.selectors.find(r=>Array.from(document.querySelectorAll(r)).find(o=>o===t)))}function $t(t,e){let r=Rt(e);return r&&r.name===t}var l={register:Tt,isRegisteredForElement:$t,get events(){return[...f]},set handler(t){_=t}};function Pt(t){return t.closest(`[${i.commandAttribute}]`)}function _t(t){return t.closest("turbo-frame[src]")||t.closest("turbo-frame[data-turbo-frame-src]")||t.closest("turbo-frame")}function Nt(t,e={}){if(t.tagName.toLowerCase()!=="select")return e.value=t.value||null;if(!t.multiple)return e.value=t.options[t.selectedIndex].value;e.values=Array.from(t.options).reduce((r,o)=>(o.selected&&r.push(o.value),r),[])}function Dt(t){let e=Array.from(t.attributes).reduce((r,o)=>{let n=o.value;return r[o.name]=n,r},{});return e.tag=t.tagName,e.checked=!!t.checked,e.disabled=!!t.disabled,Nt(t,e),delete e.class,delete e.action,delete e.href,delete e[i.commandAttribute],delete e[i.frameAttribute],e}var E={buildAttributePayload:Dt,findClosestCommand:Pt,findClosestFrameWithSource:_t};var It=(t,e={})=>{let r=t.querySelector('input[name="turbo_boost_command"]')||document.createElement("input");r.type="hidden",r.name="turbo_boost_command",r.value=JSON.stringify(e),t.contains(r)||t.appendChild(r)},X={invokeCommand:It};function Bt(t){setTimeout(()=>c(a.finish,t.target,{detail:t.detail}))}var jt=[a.abort,a.serverError,a.success];jt.forEach(t=>addEventListener(t,Bt));addEventListener(a.finish,t=>C.remove(t.detail.id),!0);var K={events:a};var zt=t=>{let e=document.createElement("a");return e.href=t,new URL(e)},G={get commandInvocationURL(){return zt("/turbo-boost-command-invocation")}};var Q=t=>{let e=`Unexpected error performing a TurboBoost Command! ${t.message}`;c(K.events.clientError,document,{detail:{message:e,error:t}},!0)},Mt=t=>{let{strategy:e}=p.tokenize(t.headers.get(p.RESPONSE_HEADER));t.text().then(r=>S(e,r))},x=(t={})=>{try{fetch(G.commandInvocationURL.href,{method:"POST",headers:p.prepare({}),body:JSON.stringify(t)}).then(Mt).catch(Q)}catch(e){Q(e)}};var Ft=(t,e)=>x(e),N={invokeCommand:Ft};var y,D,Jt=()=>{y=null,D=null},qt=(t,e={})=>{y=t,D=e},Ht=t=>{try{if(!y||t.getAttribute("method")!==y.dataset.turboMethod||t.getAttribute("action")!==y.href)return;let e=t.querySelector('input[name="turbo_boost_command"]')||document.createElement("input");e.type="hidden",e.name="turbo_boost_command",e.value=JSON.stringify(D),t.contains(e)||t.appendChild(e)}finally{Jt()}};document.addEventListener("submit",t=>Ht(t.target),!0);var Y={invokeCommand:qt};var Ut=(t,e={})=>x(e),Z={invokeCommand:Ut};function I(t,e){return e=e||{dataset:{}},t.href||e.src||e.dataset.src||location.href}function Vt(t){let e=E.findClosestFrameWithSource(t),{turboFrame:r,turboMethod:o}=t.dataset;return t.tagName.toLowerCase()==="form"?{name:"form",reason:"Element is a form.",frame:e,src:t.action,invokeCommand:X.invokeCommand}:o&&o.length>0?{name:"method",reason:"Element defines data-turbo-method.",frame:e,src:t.href,invokeCommand:Y.invokeCommand}:r&&r!=="_self"?(e=document.getElementById(r),{name:"frame",reason:"element targets a frame that is not _self",frame:e,src:I(t,e),invokeCommand:N.invokeCommand}):(!r||r==="_self")&&e?{name:"frame",reason:"element does NOT target a frame or targets _self and is contained by a frame",frame:e,src:I(t,e),invokeCommand:N.invokeCommand}:{name:"window",reason:"element matches one or more of the following conditions (targets _top, does NOT target a frame, is NOT contained by a frame)",frame:null,src:I(t),invokeCommand:Z.invokeCommand}}var B={find:Vt};var L="unknown",tt=!1,k=[],g={debug:Object.values(a),info:Object.values(a),warn:[a.abort,a.clientError,a.serverError],error:[a.clientError,a.serverError],unknown:[]},Wt=t=>{if(!g[L].includes(t.type)||typeof console[L]!="function")return!1;let{detail:e}=t;if(!e.id)return!0;let r=`${t.type}-${e.id}`;return k.includes(r)?!1:(k.length>16&&k.shift(),k.push(r),!0)},Xt=t=>g.error.includes(t.type)?"error":g.warn.includes(t.type)?"warn":g.info.includes(t.type)?"info":g.debug.includes(t.type)?"debug":"log",Kt=t=>{if(Wt(t)){let{target:e,type:r,detail:o}=t,n=o.id||"",d=o.name||"",u="";o.startedAt&&(u=`${Date.now()-o.startedAt}ms `);let J=r.split(":"),mt=J.pop(),q=`%c${J.join(":")}:%c${mt}`,lt=[`%c${d}`,`%c${u}`,q];console[Xt(t)](lt.join(" ").replace(/\s{2,}/g," "),"color:deepskyblue","color:lime","color:darkgray",q.match(/abort|error/i)?"color:red":"color:deepskyblue",{id:n,detail:o,target:e})}};tt||(tt=!0,Object.values(a).forEach(t=>addEventListener(t,e=>Kt(e))));var et={get level(){return L},set level(t){return Object.keys(g).includes(t)||(t="unknown"),L=t}};var j;function w(t,e=null){if(!t||typeof t!="object")return t;let r=new Proxy(t,{deleteProperty(o,n){return delete o[n],c(m.stateChange,document,{detail:{state:j}}),!0},set(o,n,d,u){return o[n]=w(d,this),c(m.stateChange,document,{detail:{state:j}}),!0}});if(Array.isArray(t))t.forEach((o,n)=>t[n]=w(o,r));else if(typeof t=="object")for(let[o,n]of Object.entries(t))t[o]=w(n,r);return e||(j=r),r}var z=w;function Gt(t,e){t.forEach(r=>{if(r.type==="attributes"&&r.target.hasAttribute(i.pageStateAttribute)){let o=r.target.getAttribute(i.pageStateAttribute);JSON.parse(o).includes(r.attributeName)&&c(m.pageChange,r.target,{detail:r})}})}new MutationObserver(Gt).observe(document.documentElement,{attributeOldValue:!1,attributes:!0,childList:!0,subtree:!0});function Qt(t={}){var e;for(let[r,o]of Object.entries(t))for(let[n,d]of Object.entries(o))(e=document.getElementById(r))==null||e.setAttribute(n,d)}function Yt(){return Array.from(document.querySelectorAll(`[id][${i.pageStateAttribute}]`)).reduce((e,r)=>{try{let o=r.id.trim(),n=JSON.parse(r.getAttribute(i.pageStateAttribute));if(o.length===0||n.length===0)return e;e[o]=n.reduce((d,u)=>(r.hasAttribute(u)&&(d[u]=r.getAttribute(u)||u),d),{})}catch(o){let n=`
        The element with id ${key} has an invalid value assigned to: ${i.optimisticPageStateAttribute}
        To participate in 'optimistic page state', elements must have a value that is a valid JSON string
        with an array of safe attribute names to observe.`;c(a.clientError,r,{detail:{message:n}})}return e},{})}var O={buildState:Yt,restoreState:Qt};function Zt(t,e){return typeof e!="object"&&(e={}),sessionStorage.setItem(String(t),JSON.stringify(e))}function te(t){let e=sessionStorage.getItem(String(t));return e?JSON.parse(e):{}}var M={save:Zt,find:te};var at="TurboBoost::State",ee={pageState:{},signedState:null,unsignedState:{}},T=null,R={},rt,ot,nt,st=()=>s(s({},ee),M.find(at)),F=()=>{let t=st(),e={pageState:s(s({},t.pageState),O.buildState()),signedState:s(s({},t.signedState),T),unsignedState:s(s({},t.unsignedState),R)};M.save(at,e)};function re(){if(!rt){let{pageState:t,signedState:e,unsignedState:r}=st(),o=()=>{T=e,R=z(r||{}),O.restoreState(t)};rt=[addEventListener("DOMContentLoaded",o),addEventListener(P.load,o),addEventListener(P.frameLoad,o)]}ot||(ot=[addEventListener(m.pageChange,F)]),nt||(nt=[addEventListener(m.stateChange,F)])}function oe(t){let e=JSON.parse(t),{signed:r,unsigned:o}=e;T=r,R=z(o||{}),F(),setTimeout(()=>c(m.stateInitialize,document,{detail:o}))}re();var h={initialize:oe,buildPageState:O.buildState,get signed(){return T},get unsigned(){return R}};function ne(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16))}var it={v4:ne};var dt="0.2.1";var ae=self.TurboBoost||{},ut={VERSION:dt,active:!1,confirmation:W,logger:et,schema:i,events:a,registerEventDelegate:l.register,get eventDelegates(){return l.events}};function ct(t,e){let r=e.getAttribute(i.commandAttribute);return{id:t,name:e.getAttribute(i.commandAttribute),elementId:e.id.length>0?e.id:null,elementAttributes:E.buildAttributePayload(e),startedAt:Date.now(),state:{page:h.buildPageState(),signed:h.signed,unsigned:h.unsigned}}}async function se(t){let e,r={};try{if(e=E.findClosestCommand(t.target),!e||!l.isRegisteredForElement(t.type,e))return;let o=it.v4(),n=B.find(e),d=b(s({},ct(o,e)),{driver:n.name,frameId:n.frame?n.frame.id:null,src:n.src}),u=await c(a.start,e,{cancelable:!0,detail:d});if(u.defaultPrevented||u.detail.confirmation&&t.defaultPrevented)return c(a.abort,e,{detail:{message:`An event handler for '${a.start}' prevented default behavior and blocked command invocation!`,source:u}});switch(n=B.find(e),d=b(s({},ct(o,e)),{driver:n.name,frameId:n.frame?n.frame.id:null,src:n.src}),C.add(d),["frame","window"].includes(n.name)&&t.preventDefault(),n.name){case"method":return n.invokeCommand(e,d);case"form":return n.invokeCommand(e,d,t);case"frame":return n.invokeCommand(n.frame,d);case"window":return n.invokeCommand(self,d)}}catch(o){c(a.clientError,e,{detail:b(s({},r),{error:o})})}}self.TurboBoost=s({},ae);self.TurboBoost.Commands||(l.handler=se,l.register("click",[`[${i.commandAttribute}]`]),l.register("submit",[`form[${i.commandAttribute}]`]),l.register("toggle",[`details[${i.commandAttribute}]`]),l.register("change",[`input[${i.commandAttribute}]`,`select[${i.commandAttribute}]`,`textarea[${i.commandAttribute}]`]),self.TurboBoost.Commands=ut,self.TurboBoost.State={initialize:h.initialize,get current(){return h.unsigned}});var Cr=ut;export{Cr as default};
//# sourceMappingURL=commands.js.map
