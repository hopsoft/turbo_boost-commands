var me=Object.defineProperty,de=Object.defineProperties;var ce=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var ue=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var H=(e,t,r)=>t in e?me(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,a=(e,t)=>{for(var r in t||(t={}))ue.call(t,r)&&H(e,r,t[r]);if(M)for(var r of M(t))le.call(t,r)&&H(e,r,t[r]);return e},v=(e,t)=>de(e,ce(t));var fe="TurboBoost-Command",h={boost:"text/vnd.turbo-boost.html",stream:"text/vnd.turbo-stream.html",html:"text/html",xhtml:"application/xhtml+xml",json:"application/json"},pe=(e={})=>{e=a({},e);let t=(e.Accept||"").split(",").map(r=>r.trim()).filter(r=>r.length);return t.unshift(h.boost,h.stream,h.html,h.xhtml),e.Accept=[...new Set(t)].join(", "),e["Content-Type"]=h.json,e["X-Requested-With"]="XMLHttpRequest",e},be=e=>{if(e){let[t,r,o]=e.split(", ");return{name:t,status:r,strategy:o}}return{}},b={prepare:pe,tokenize:be,RESPONSE_HEADER:fe};var x={};function ve(e){x[e.id]=e}function he(e){delete x[e]}var A={add:ve,remove:he,get commands(){return[...Object.values(x)]},get length(){return Object.keys(x).length}};var s={start:"turbo-boost:command:start",success:"turbo-boost:command:success",finish:"turbo-boost:command:finish",abort:"turbo-boost:command:abort",clientError:"turbo-boost:command:client-error",serverError:"turbo-boost:command:server-error"},u={stateLoad:"turbo-boost:state:load",stateChange:"turbo-boost:state:change"},c=a(a({},s),u);function d(e,t,r={}){return new Promise(o=>{r=r||{},r.detail=r.detail||{},t=t||document;let n=new CustomEvent(e,v(a({},r),{bubbles:!0}));t.dispatchEvent(n),o(n)})}function U(e){setTimeout(()=>d(s.finish,e.target,{detail:e.detail}))}addEventListener(s.serverError,U);addEventListener(s.success,U);addEventListener(s.finish,e=>A.remove(e.detail.id),!0);var q={events:s};function ge(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}var z={v4:ge};var Ee=e=>{document.body.insertAdjacentHTML("beforeend",e)},ye=e=>{let r=new DOMParser().parseFromString(e,"text/html");TurboBoost.Streams.morph.method(document.documentElement,r.documentElement)},C=(e,t)=>{if(e&&t){if(e.match(/^Append$/i))return Ee(t);if(e.match(/^Replace$/i))return ye(t)}};var R={};addEventListener("turbo:before-fetch-response",e=>{let t=e.target.closest("turbo-frame");t!=null&&t.id&&(t!=null&&t.src)&&(R[t.id]=t.src);let{fetchResponse:r}=e.detail,o=r.header(b.RESPONSE_HEADER);if(!o)return;e.preventDefault();let{strategy:n}=b.tokenize(o);r.responseHTML.then(m=>C(n,m))});addEventListener("turbo:frame-load",e=>{let t=e.target.closest("turbo-frame");t.dataset.src=R[t.id]||t.src||t.dataset.src,delete R[t.id]});var xe={frameAttribute:"data-turbo-frame",methodAttribute:"data-turbo-method",commandAttribute:"data-turbo-command",confirmAttribute:"data-turbo-confirm"},i=a({},xe);var J={method:e=>Promise.resolve(confirm(e))},Ae=e=>e.detail.driver==="method",Ce=e=>{if(e.detail.driver!=="form")return!1;let t=e.target,r=t.closest("turbo-frame"),o=t.closest(`[${i.frameAttribute}]`);return!!(r||o)},ke=e=>Ae(e)||Ce(e);document.addEventListener(s.start,async e=>{let t=e.target.getAttribute(i.confirmAttribute);if(!t||(e.detail.confirmation=!0,ke(e)))return;await J.method(t)||e.preventDefault()});var V=J;var l=[],T;function Se(e,t){let r=l.find(o=>o.name===e);return r&&l.splice(l.indexOf(r),1),l=[{name:e,selectors:t},...l],document.removeEventListener(e,T,!0),document.addEventListener(e,T,!0),a({},l.find(o=>o.name===e))}function we(e){return l.find(t=>t.selectors.find(r=>Array.from(document.querySelectorAll(r)).find(o=>o===e)))}function Le(e,t){let r=we(t);return r&&r.name===e}var f={register:Se,isRegisteredForElement:Le,get events(){return[...l]},set handler(e){T=e}};function Oe(e){return e.closest(`[${i.commandAttribute}]`)}function Re(e){return e.closest("turbo-frame[src]")||e.closest("turbo-frame[data-turbo-frame-src]")||e.closest("turbo-frame")}function Te(e,t={}){if(e.tagName.toLowerCase()!=="select")return t.value=e.value||null;if(!e.multiple)return t.value=e.options[e.selectedIndex].value;t.values=Array.from(e.options).reduce((r,o)=>(o.selected&&r.push(o.value),r),[])}function $e(e){let t=Array.from(e.attributes).reduce((r,o)=>{let n=o.value;return r[o.name]=n,r},{});return t.tag=e.tagName,t.checked=!!e.checked,t.disabled=!!e.disabled,Te(e,t),delete t.class,delete t.action,delete t.href,delete t[i.commandAttribute],delete t[i.frameAttribute],t}var g={buildAttributePayload:$e,findClosestCommand:Oe,findClosestFrameWithSource:Re};var Pe=(e,t={})=>{let r=e.querySelector('input[name="turbo_boost_command"]')||document.createElement("input");r.type="hidden",r.name="turbo_boost_command",r.value=JSON.stringify(t),e.contains(r)||e.appendChild(r)},W={invokeCommand:Pe};var $;function k(e,t=null){if(!e||typeof e!="object")return e;let r=new Proxy(e,{deleteProperty(o,n){return delete o[n],d(u.stateChange,document,{detail:{state:$}}),!0},set(o,n,m,p){return o[n]=k(m,this),d(u.stateChange,document,{detail:{state:$}}),!0}});if(Array.isArray(e))e.forEach((o,n)=>e[n]=k(o,r));else if(typeof e=="object")for(let[o,n]of Object.entries(e))e[o]=k(n,r);return t||($=r),r}var X=k;var P,S,_,G;function _e(e,t){let r=JSON.parse(e);P=a({},r),G=t,S=X(r),_={},setTimeout(()=>d(u.stateLoad,document,{detail:{state:S}}))}addEventListener(u.stateChange,e=>{for(let[t,r]of Object.entries(S))P[t]!==r&&(_[t]=r)});var E={initialize:_e,events:u,get initial(){return P},get current(){return S},get changed(){return _},get signed(){return G}};var De=e=>{let t=document.createElement("a");return t.href=e,new URL(t)},K={get commandInvocationURL(){return De("/turbo-boost-command-invocation")}};var Q=e=>{let t=`Unexpected error performing a TurboBoost Command! ${e.message}`;d(q.events.clientError,document,{detail:{error:t}},!0)},Ne=e=>{let{strategy:t}=b.tokenize(e.headers.get(b.RESPONSE_HEADER));e.text().then(r=>C(t,r))},w=(e={})=>{try{fetch(K.commandInvocationURL.href,{method:"POST",headers:b.prepare({}),body:JSON.stringify(e)}).then(Ne).catch(Q)}catch(t){Q(t)}};var Be=(e,t)=>w(t),D={invokeCommand:Be};var y,N,je=()=>{y=null,N=null},Fe=(e,t={})=>{y=e,N=t},Ie=e=>{try{if(!y||e.getAttribute("method")!==y.dataset.turboMethod||e.getAttribute("action")!==y.href)return;let t=e.querySelector('input[name="turbo_boost_command"]')||document.createElement("input");t.type="hidden",t.name="turbo_boost_command",t.value=JSON.stringify(N),e.contains(t)||e.appendChild(t)}finally{je()}};document.addEventListener("submit",e=>Ie(e.target),!0);var Y={invokeCommand:Fe};var Me=(e,t={})=>w(t),Z={invokeCommand:Me};function B(e,t){return t=t||{dataset:{}},e.href||t.src||t.dataset.src||location.href}function He(e){let t=g.findClosestFrameWithSource(e),{turboFrame:r,turboMethod:o}=e.dataset;return e.tagName.toLowerCase()==="form"?{name:"form",reason:"Element is a form.",frame:t,src:e.action,invokeCommand:W.invokeCommand}:o&&o.length>0?{name:"method",reason:"Element defines data-turbo-method.",frame:t,src:e.href,invokeCommand:Y.invokeCommand}:r&&r!=="_self"?(t=document.getElementById(r),{name:"frame",reason:"element targets a frame that is not _self",frame:t,src:B(e,t),invokeCommand:D.invokeCommand}):(!r||r==="_self")&&t?{name:"frame",reason:"element does NOT target a frame or targets _self and is contained by a frame",frame:t,src:B(e,t),invokeCommand:D.invokeCommand}:{name:"window",reason:"element matches one or more of the following conditions (targets _top, does NOT target a frame, is NOT contained by a frame)",frame:null,src:B(e),invokeCommand:Z.invokeCommand}}var j={find:He};var O="unknown",ee=!1,L=[],te={debug:Object.values(c),info:Object.values(c),warn:[c.abort,c.clientError,c.serverError],error:[c.clientError,c.serverError],unknown:[]},Ue=e=>{if(!te[O].includes(e.type)||typeof console[O]!="function")return!1;let{detail:t}=e;if(!t.id)return!0;let r=`${e.type}-${t.id}`;return L.includes(r)?!1:(L.length>16&&L.shift(),L.push(r),!0)},qe=e=>{if(Ue(e)){let{target:t,type:r,detail:o}=e,n=o.id||"",m=o.name||"",p="";o.startedAt&&(p=`${Date.now()-o.startedAt}ms `);let F=r.split(":"),se=F.pop(),I=`%c${F.join(":")}:%c${se}`,ie=[`%c${m}`,`%c${p}`,I,`%c${n}`];console.log(ie.join(" ").replace(/\s{2,}/g," "),"color:deepskyblue","color:lime","color:dimgray",I.match(/error/i)?"color:red":"color:cyan","color:silver",{detail:o,target:t})}};ee||(ee=!0,Object.values(c).forEach(e=>addEventListener(e,t=>qe(t))));var re={get level(){return O},set level(e){return Object.keys(te).includes(e)||(e="unknown"),O=e}};var oe="0.2.1";var ze=self.TurboBoost||{},ae={VERSION:oe,active:!1,confirmation:V,logger:re,schema:i,events:s,registerEventDelegate:f.register,get eventDelegates(){return f.events}};function ne(e,t){return{id:e,name:t.getAttribute(i.commandAttribute),elementId:t.id.length>0?t.id:null,elementAttributes:g.buildAttributePayload(t),startedAt:Date.now(),changedState:E.changed,clientState:E.current,signedState:E.signed}}async function Je(e){let t,r={};try{if(t=g.findClosestCommand(e.target),!t||!f.isRegisteredForElement(e.type,t))return;let o=z.v4(),n=j.find(t),m=v(a({},ne(o,t)),{driver:n.name,frameId:n.frame?n.frame.id:null,src:n.src}),p=await d(s.start,t,{cancelable:!0,detail:m});if(p.defaultPrevented||p.detail.confirmation&&e.defaultPrevented)return d(s.abort,t,{detail:{message:`An event handler for '${s.start}' prevented default behavior and blocked command invocation!`,source:p}});switch(n=j.find(t),m=v(a({},ne(o,t)),{driver:n.name,frameId:n.frame?n.frame.id:null,src:n.src}),A.add(m),["frame","window"].includes(n.name)&&e.preventDefault(),n.name){case"method":return n.invokeCommand(t,m);case"form":return n.invokeCommand(t,m,e);case"frame":return n.invokeCommand(n.frame,m);case"window":return n.invokeCommand(self,m)}}catch(o){d(s.clientError,t,{detail:v(a({},r),{error:o})})}}self.TurboBoost=a({},ze);self.TurboBoost.Commands||(f.handler=Je,f.register("click",[`[${i.commandAttribute}]`]),f.register("submit",[`form[${i.commandAttribute}]`]),f.register("change",[`input[${i.commandAttribute}]`,`select[${i.commandAttribute}]`,`textarea[${i.commandAttribute}]`]),self.TurboBoost.Commands=ae,self.TurboBoost.State=E);var fr=ae;export{fr as default};
//# sourceMappingURL=commands.js.map
