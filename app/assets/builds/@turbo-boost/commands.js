var q=Object.defineProperty,F=Object.defineProperties;var M=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var B=(e,t,r)=>t in e?q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,s=(e,t)=>{for(var r in t||(t={}))N.call(t,r)&&B(e,r,t[r]);if(O)for(var r of O(t))W.call(t,r)&&B(e,r,t[r]);return e},d=(e,t)=>F(e,M(t));function U(e){let t="<html",r="</html",o=e.indexOf(t),n=e.lastIndexOf(r);if(o>=0&&n>=0){let c=e.slice(e.indexOf(">",o)+1,n);document.documentElement.innerHTML=c}}function J(e){document.body.insertAdjacentHTML("beforeend",e)}var b={append:J,replaceDocument:U};var a={start:"turbo-boost:command:start",success:"turbo-boost:command:success",finish:"turbo-boost:command:finish",abort:"turbo-boost:command:abort",clientError:"turbo-boost:command:client-error",serverError:"turbo-boost:command:server-error"},u=s({},a);function m(e,t,r={}){return new Promise(o=>{r=r||{},r.detail=r.detail||{},t=t||document;let n=new CustomEvent(e,d(s({},r),{bubbles:!0}));t.dispatchEvent(n),o(n)})}var g={};function V(e){g[e.id]=e}function G(e){delete g[e]}var E={add:V,remove:G,get commands(){return[...Object.values(g)]},get length(){return Object.keys(g).length}};function D(e){e.detail.endedAt=Date.now(),e.detail.milliseconds=e.detail.endedAt-e.detail.startedAt,setTimeout(()=>m(a.finish,e.target,{detail:e.detail}),25)}addEventListener(a.serverError,D);addEventListener(a.success,D);addEventListener(a.finish,e=>E.remove(e.detail.id),!0);var h={events:a};var A={};addEventListener("turbo:before-fetch-request",e=>{let t=e.target.closest("turbo-frame"),{fetchOptions:r}=e.detail,o=["text/vnd.turbo-boost.html",r.headers.Accept];o=o.filter(n=>n&&n.trim().length>0).join(", "),r.headers.Accept=o});addEventListener("turbo:before-fetch-response",e=>{let t=e.target.closest("turbo-frame"),{fetchResponse:r}=e.detail;if(t&&(A[t.id]=t.src),r.header("TurboBoost")){if(r.statusCode<200||r.statusCode>399){let o=`Server returned a ${r.statusCode} status code! TurboBoost Commands require 2XX-3XX status codes.`;m(h.events.clientError,document,{detail:d(s({},e.detail),{error:o})},!0)}r.header("TurboBoost")==="Append"&&(e.preventDefault(),r.responseText.then(o=>b.append(o)))}});addEventListener("turbo:frame-load",e=>{let t=e.target.closest("turbo-frame");t.dataset.turboBoostSrc=A[t.id]||t.src||t.dataset.turboBoostSrc,delete A[t.id]});var z={frameAttribute:"data-turbo-frame",methodAttribute:"data-turbo-method",commandAttribute:"data-turbo-command",confirmAttribute:"data-turbo-confirm"},i=s({},z);var S={method:e=>Promise.resolve(confirm(e))},K=e=>e.detail.driver==="method",Q=e=>{if(e.detail.driver!=="form")return!1;let t=e.target,r=t.closest("turbo-frame"),o=t.closest(`[${i.frameAttribute}]`);return!!(r||o)},Y=e=>K(e)||Q(e);document.addEventListener(a.start,async e=>{let t=e.target.getAttribute(i.confirmAttribute);if(!t||(e.detail.confirmation=!0,Y(e)))return;await S.method(t)||e.preventDefault()});var R=S;var f=[],T;function Z(e,t){let r=f.find(o=>o.name===e);return r&&f.splice(f.indexOf(r),1),f=[{name:e,selectors:t},...f],document.removeEventListener(e,T,!0),document.addEventListener(e,T,!0),s({},f.find(o=>o.name===e))}function ee(e){return f.find(t=>t.selectors.find(r=>Array.from(document.querySelectorAll(r)).find(o=>o===e)))}function te(e,t){let r=ee(t);return r&&r.name===e}var l={register:Z,isRegisteredForElement:te,get events(){return[...f]},set handler(e){T=e}};function re(e){return e.closest(`[${i.commandAttribute}]`)}function oe(e){return e.closest("turbo-frame[src]")||e.closest("turbo-frame[data-turbo-frame-src]")||e.closest("turbo-frame")}function ne(e,t={}){if(e.tagName.toLowerCase()!=="select")return t.value=e.value||null;if(!e.multiple)return t.value=e.options[e.selectedIndex].value;t.values=Array.from(e.options).reduce((r,o)=>(o.selected&&r.push(o.value),r),[])}function se(e){let t=Array.from(e.attributes).reduce((r,o)=>{let n=o.value;return r[o.name]=n,r},{});return t.tag=e.tagName,t.checked=!!e.checked,t.disabled=!!e.disabled,ne(e,t),delete t.class,delete t.action,delete t.href,delete t[i.commandAttribute],delete t[i.frameAttribute],t}var v={buildAttributePayload:se,findClosestCommand:re,findClosestFrameWithSource:oe};function ae(e,t={},r={}){let o=e.querySelector('input[name="turbo_boost_command"]')||document.createElement("input");o.type="hidden",o.name="turbo_boost_command",o.value=JSON.stringify(t),e.appendChild(o)}var $={invokeCommand:ae};function ie(e,t={}){let r=document.createElement("a");r.href=e;let o=new URL(r);return o.searchParams.set("turbo_boost_command",JSON.stringify(t)),o}var p={build:ie};function de(e,t){let r=t.src;t=s({},t),delete t.src,e.src=p.build(r,t)}var k={invokeCommand:de};function me(e,t={}){let r=t.src;t=s({},t),delete t.src,delete t.href,e.setAttribute("href",p.build(r,t))}var _={invokeCommand:me};function ce(e){let t=e.target;m(h.events.abort,document,{detail:d(s({},e.detail),{xhr:t})})}function w(e){let t=e.target;(t.getResponseHeader("TurboBoost")==="Append"||t.getResponseHeader("Content-Type").startsWith("text/vnd.turbo-boost.html"))&&b.append(t.responseText);let o=`Server returned a ${t.status} status code! TurboBoost Commands require 2XX-3XX status codes.`;m(h.events.clientError,document,{detail:d(s({},e.detail),{error:o,xhr:t})},!0)}function ue(e){let t=e.target;if(t.status<200||t.status>399)return w(e);let r=t.responseText;t.getResponseHeader("TurboBoost")==="Append"||t.getResponseHeader("Content-Type").startsWith("text/vnd.turbo-boost.html")?b.append(t.responseText):b.replaceDocument(t.responseText)}function fe(e){let t=e.src;e=s({},e),delete e.src;try{let r=new XMLHttpRequest;r.open("GET",p.build(t,e),!0),r.setRequestHeader("Accept","text/vnd.turbo-boost.html, text/html, application/xhtml+xml"),r.addEventListener("abort",ce),r.addEventListener("error",w),r.addEventListener("load",ue),r.send()}catch(r){let o=`Unexpected error sending HTTP request! ${r.message}`;w(r,{detail:{message:o}})}}var H={invokeCommand:fe};function L(e,t){return t=t||{dataset:{}},e.href||t.src||t.dataset.turboBoostSrc||location.href}function le(e){let t=v.findClosestFrameWithSource(e),{turboFrame:r,turboMethod:o}=e.dataset;return e.tagName.toLowerCase()==="form"?{name:"form",reason:"Element is a form.",frame:t,src:e.action,invokeCommand:$.invokeCommand}:o&&o.length>0?{name:"method",reason:"Element defines data-turbo-method.",frame:t,src:e.href,invokeCommand:_.invokeCommand}:r&&r!=="_self"?(t=document.getElementById(r),{name:"frame",reason:"element targets a frame that is not _self",frame:t,src:L(e,t),invokeCommand:k.invokeCommand}):(!r||r==="_self")&&t?{name:"frame",reason:"element does NOT target a frame or targets _self and is contained by a frame",frame:t,src:L(e,t),invokeCommand:k.invokeCommand}:{name:"window",reason:"element matches one or more of the following conditions (targets _top, does NOT target a frame, is NOT contained by a frame)",frame:null,src:L(e),invokeCommand:H.invokeCommand}}var y={find:le};var x="unknown",P={debug:Object.values(u),info:Object.values(u),warn:[u.abort,u.clientError,u.serverError],error:[u.clientError,u.serverError],unknown:[]};Object.values(u).forEach(e=>{addEventListener(e,t=>{if(P[x].includes(t.type)){let{target:r,detail:o}=t;console[x](t.type,{target:r,detail:o})}})});var I={get level(){return x},set level(e){return Object.keys(P).includes(e)||(e="unknown"),x=e}};function be(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}var X={v4:be};function j(e,t){return{id:e,name:t.getAttribute(i.commandAttribute),elementId:t.id.length>0?t.id:null,elementAttributes:v.buildAttributePayload(t),startedAt:Date.now()}}async function pe(e){let t,r={};try{if(t=v.findClosestCommand(e.target),!t||!l.isRegisteredForElement(e.type,t))return;let o=`turbo-command-${X.v4()}`,n=y.find(t),c=d(s({},j(o,t)),{driver:n.name,frameId:n.frame?n.frame.id:null,src:n.src}),C=await m(a.start,t,{cancelable:!0,detail:c});if(C.defaultPrevented||C.detail.confirmation&&e.defaultPrevented)return m(a.abort,t,{detail:{message:`An event handler for '${a.start}' prevented default behavior and blocked command invocation!`,source:C}});switch(n=y.find(t),c=d(s({},j(o,t)),{driver:n.name,frameId:n.frame?n.frame.id:null,src:n.src}),E.add(c),["frame","window"].includes(n.name)&&e.preventDefault(),n.name){case"method":return n.invokeCommand(t,c);case"form":return n.invokeCommand(t,c,e);case"frame":return n.invokeCommand(n.frame,c);case"window":return n.invokeCommand(c)}}catch(o){m(a.clientError,t,{detail:d(s({},r),{error:o})})}}self.TurboBoost=self.TurboBoost||{};self.TurboBoost.Commands||(l.handler=pe,l.register("click",[`[${i.commandAttribute}]`]),l.register("submit",[`form[${i.commandAttribute}]`]),l.register("change",[`input[${i.commandAttribute}]`,`select[${i.commandAttribute}]`,`textarea[${i.commandAttribute}]`]),self.TurboBoost.Commands={confirmation:R,logger:I,schema:i,events:a,registerEventDelegate:l.register,get eventDelegates(){return l.events}});var At=self.TurboBoost.Commands;export{At as default};
//# sourceMappingURL=commands.js.map
