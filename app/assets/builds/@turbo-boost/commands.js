var ft=Object.defineProperty,pt=Object.defineProperties;var bt=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var gt=Object.prototype.hasOwnProperty,ht=Object.prototype.propertyIsEnumerable;var G=(t,e,r)=>e in t?ft(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,s=(t,e)=>{for(var r in e||(e={}))gt.call(e,r)&&G(t,r,e[r]);if(X)for(var r of X(e))ht.call(e,r)&&G(t,r,e[r]);return t},p=(t,e)=>pt(t,bt(e));var vt="TurboBoost-Command",y={boost:"text/vnd.turbo-boost.html",stream:"text/vnd.turbo-stream.html",html:"text/html",xhtml:"application/xhtml+xml",json:"application/json"},yt=(t={})=>{t=s({},t);let e=(t.Accept||"").split(",").map(r=>r.trim()).filter(r=>r.length);return e.unshift(y.boost,y.stream,y.html,y.xhtml),t.Accept=[...new Set(e)].join(", "),t["Content-Type"]=y.json,t["X-Requested-With"]="XMLHttpRequest",t},Et=t=>{if(t){let[e,r,o]=t.split(", ");return{name:e,status:r,strategy:o}}return{}},f={prepare:yt,tokenize:Et,RESPONSE_HEADER:vt};var At=t=>{document.body.insertAdjacentHTML("beforeend",t)},St=t=>{var h,k,v,C;let r=new DOMParser().parseFromString(t,"text/html"),o=document.querySelector("head"),n=document.querySelector("body"),i=r.querySelector("head"),m=r.querySelector("body");o&&i&&((k=(h=TurboBoost==null?void 0:TurboBoost.Streams)==null?void 0:h.morph)==null||k.method(o,i)),n&&m&&((C=(v=TurboBoost==null?void 0:TurboBoost.Streams)==null?void 0:v.morph)==null||C.method(n,m))},w=(t,e)=>{if(t&&e){if(t.match(/^Append$/i))return At(e);if(t.match(/^Replace$/i))return St(e)}};var I={};addEventListener("turbo:before-fetch-response",t=>{let e=t.target.closest("turbo-frame");e!=null&&e.id&&(e!=null&&e.src)&&(I[e.id]=e.src);let{fetchResponse:r}=t.detail,o=r.header(f.RESPONSE_HEADER);if(!o)return;t.preventDefault();let{strategy:n}=f.tokenize(o);r.responseHTML.then(i=>w(n,i))});addEventListener("turbo:frame-load",t=>{let e=t.target.closest("turbo-frame");e.dataset.src=I[e.id]||e.src||e.dataset.src,delete I[e.id]});var xt={frameAttribute:"data-turbo-frame",methodAttribute:"data-turbo-method",commandAttribute:"data-turbo-command",confirmAttribute:"data-turbo-confirm",pageStateAttribute:"data-retain"},d=s({},xt);var a={start:"turbo-boost:command:start",success:"turbo-boost:command:success",finish:"turbo-boost:command:finish",abort:"turbo-boost:command:abort",clientError:"turbo-boost:command:client-error",serverError:"turbo-boost:command:server-error"},E={stateChange:"turbo-boost:state:change",stateInitialize:"turbo-boost:state:initialize"},z={frameLoad:"turbo:frame-load",load:"turbo:load"};function c(t,e,r={}){return new Promise(o=>{r=r||{},r.detail=r.detail||{},e=e||document;let n=new CustomEvent(t,p(s({},r),{bubbles:!0}));e.dispatchEvent(n),o(n)})}var T={};function kt(t){T[t.id]=t}function Ct(t){delete T[t]}var O={add:kt,remove:Ct,get commands(){return[...Object.values(T)]},get length(){return Object.keys(T).length}};var K={method:t=>Promise.resolve(confirm(t))},wt=t=>t.detail.driver==="method",Tt=t=>{if(t.detail.driver!=="form")return!1;let e=t.target,r=e.closest("turbo-frame"),o=e.closest(`[${d.frameAttribute}]`);return!!(r||o)},Ot=t=>wt(t)||Tt(t);document.addEventListener(a.start,async t=>{let e=t.target.getAttribute(d.confirmAttribute);if(!e||(t.detail.confirmation=!0,Ot(t)))return;await K.method(e)||t.preventDefault()});var Q=K;var l=[],j;function Lt(t,e){let r=l.find(o=>o.name===t);return r&&l.splice(l.indexOf(r),1),l=[{name:t,selectors:e},...l],document.removeEventListener(t,j,!0),document.addEventListener(t,j,!0),s({},l.find(o=>o.name===t))}function Rt(t){return l.find(e=>e.selectors.find(r=>Array.from(document.querySelectorAll(r)).find(o=>o===t)))}function $t(t,e){let r=Rt(e);return r&&r.name===t}var u={register:Lt,isRegisteredForElement:$t,get events(){return[...l]},set handler(t){j=t}};function Pt(t){return t.closest(`[${d.commandAttribute}]`)}function _t(t){return t.closest("turbo-frame[src]")||t.closest("turbo-frame[data-turbo-frame-src]")||t.closest("turbo-frame")}function Dt(t,e={}){if(t.tagName.toLowerCase()!=="select")return e.value=t.value||null;if(!t.multiple)return e.value=t.options[t.selectedIndex].value;e.values=Array.from(t.options).reduce((r,o)=>(o.selected&&r.push(o.value),r),[])}function Nt(t){let e=Array.from(t.attributes).reduce((r,o)=>{let n=o.value;return r[o.name]=n,r},{});return e.tag=t.tagName,e.checked=!!t.checked,e.disabled=!!t.disabled,Dt(t,e),delete e.class,delete e.action,delete e.href,delete e[d.commandAttribute],delete e[d.frameAttribute],e}var A={buildAttributePayload:Nt,findClosestCommand:Pt,findClosestFrameWithSource:_t};var Bt=(t,e={})=>{let r=t.querySelector('input[name="turbo_boost_command"]')||document.createElement("input");r.type="hidden",r.name="turbo_boost_command",r.value=JSON.stringify(e),t.contains(r)||t.appendChild(r)},Y={invokeCommand:Bt};function It(t){setTimeout(()=>c(a.finish,t.target,{detail:t.detail}))}var zt=[a.abort,a.serverError,a.success];zt.forEach(t=>addEventListener(t,It));addEventListener(a.finish,t=>O.remove(t.detail.id),!0);var Z={events:a};var jt=t=>{let e=document.createElement("a");return e.href=t,new URL(e)},tt={get commandInvocationURL(){return jt("/turbo-boost-command-invocation")}};var et=t=>{let e=`Unexpected error performing a TurboBoost Command! ${t.message}`;c(Z.events.clientError,document,{detail:{message:e,error:t}},!0)},qt=t=>{let{strategy:e}=f.tokenize(t.headers.get(f.RESPONSE_HEADER));t.text().then(r=>w(e,r))},L=(t={})=>{try{fetch(tt.commandInvocationURL.href,{method:"POST",headers:f.prepare({}),body:JSON.stringify(t)}).then(qt).catch(et)}catch(e){et(e)}};var Mt=(t,e)=>L(e),q={invokeCommand:Mt};var S,M,Ft=()=>{S=null,M=null},Jt=(t,e={})=>{S=t,M=e},Ht=t=>{try{if(!S||t.getAttribute("method")!==S.dataset.turboMethod||t.getAttribute("action")!==S.href)return;let e=t.querySelector('input[name="turbo_boost_command"]')||document.createElement("input");e.type="hidden",e.name="turbo_boost_command",e.value=JSON.stringify(M),t.contains(e)||t.appendChild(e)}finally{Ft()}};document.addEventListener("submit",t=>Ht(t.target),!0);var rt={invokeCommand:Jt};var Ut=(t,e={})=>L(e),ot={invokeCommand:Ut};function F(t,e){return e=e||{dataset:{}},t.href||e.src||e.dataset.src||location.href}function Vt(t){let e=A.findClosestFrameWithSource(t),{turboFrame:r,turboMethod:o}=t.dataset;return t.tagName.toLowerCase()==="form"?{name:"form",reason:"Element is a form.",frame:e,src:t.action,invokeCommand:Y.invokeCommand}:o&&o.length>0?{name:"method",reason:"Element defines data-turbo-method.",frame:e,src:t.href,invokeCommand:rt.invokeCommand}:r&&r!=="_self"?(e=document.getElementById(r),{name:"frame",reason:"element targets a frame that is not _self",frame:e,src:F(t,e),invokeCommand:q.invokeCommand}):(!r||r==="_self")&&e?{name:"frame",reason:"element does NOT target a frame or targets _self and is contained by a frame",frame:e,src:F(t,e),invokeCommand:q.invokeCommand}:{name:"window",reason:"element matches one or more of the following conditions (targets _top, does NOT target a frame, is NOT contained by a frame)",frame:null,src:F(t),invokeCommand:ot.invokeCommand}}var J={find:Vt};var $="unknown",nt=!1,R=[],b={debug:Object.values(a),info:Object.values(a),warn:[a.abort,a.clientError,a.serverError],error:[a.clientError,a.serverError],unknown:[]},Wt=t=>{if(!b[$].includes(t.type)||typeof console[$]!="function")return!1;let{detail:e}=t;if(!e.id)return!0;let r=`${t.type}-${e.id}`;return R.includes(r)?!1:(R.length>16&&R.shift(),R.push(r),!0)},Xt=t=>b.error.includes(t.type)?"error":b.warn.includes(t.type)?"warn":b.info.includes(t.type)?"info":b.debug.includes(t.type)?"debug":"log",Gt=t=>{if(Wt(t)){let{target:e,type:r,detail:o}=t,n=o.id||"",i=o.name||"",m="";o.startedAt&&(m=`${Date.now()-o.startedAt}ms `);let h=r.split(":"),k=h.pop(),v=`%c${h.join(":")}:%c${k}`,C=[`%c${i}`,`%c${m}`,v];console[Xt(t)](C.join(" ").replace(/\s{2,}/g," "),"color:deepskyblue","color:lime","color:darkgray",v.match(/abort|error/i)?"color:red":"color:deepskyblue",{id:n,detail:o,target:e})}};nt||(nt=!0,Object.values(a).forEach(t=>addEventListener(t,e=>Gt(e))));var at={get level(){return $},set level(t){return Object.keys(b).includes(t)||(t="unknown"),$=t}};var H;function P(t,e=null){if(!t||typeof t!="object")return t;let r=new Proxy(t,{deleteProperty(o,n){return delete o[n],c(E.stateChange,document,{detail:{state:H}}),!0},set(o,n,i,m){return o[n]=P(i,this),c(E.stateChange,document,{detail:{state:H}}),!0}});if(Array.isArray(t))t.forEach((o,n)=>t[n]=P(o,r));else if(typeof t=="object")for(let[o,n]of Object.entries(t))t[o]=P(n,r);return e||(H=r),r}var st=P;var _=!1;var Kt=()=>Array.from(document.querySelectorAll(`[id][${d.pageStateAttribute}]`)).reduce((e,r)=>{try{let o=r.id.trim(),n=JSON.parse(r.getAttribute(d.pageStateAttribute));if(o.length===0||n.length===0)return e;e[o]=n.reduce((i,m)=>(r.hasAttribute(m)&&(i[m]=r.getAttribute(m)||m),i),{})}catch(o){let n=`
        The element with id ${key} has an invalid value assigned to: ${d.optimisticPageStateAttribute}
        To participate in 'optimistic page state', elements must have a value that is a valid JSON string
        with an array of safe attribute names to observe.`;c(a.clientError,r,{detail:{message:n}})}return e},{}),Qt=(t={})=>{var e;if(!_){_=!0,console.log("restoreState",t);try{for(let[r,o]of Object.entries(t))for(let[n,i]of Object.entries(o))(e=document.getElementById(r))==null||e.setAttribute(n,i)}finally{_=!1}}},D={buildState:Kt,restoreState:Qt,get restoring(){return _}};function Yt(t,e){return typeof e!="object"&&(e={}),sessionStorage.setItem(String(t),JSON.stringify(e))}function Zt(t){let e=sessionStorage.getItem(String(t));return e?JSON.parse(e):{}}var N={save:Yt,find:Zt};var U="TurboBoost::State",it={page:{},signed:null,unsigned:{}},W=null,B={},x=null,V,te=()=>{clearTimeout(V),V=setTimeout(()=>x=null,1e3)},ee=()=>{clearTimeout(V),x=x||s(s({},it),N.find(U)),D.restoreState(x.page),te()},re=[z.frameLoad,z.load,"DOMContentLoaded"];re.forEach(t=>addEventListener(t,ee));var dt=()=>{if(x)return;let t=s(s({},it),N.find(U)),e={signed:W||t.signed,unsigned:s(s({},t.unsigned),B),page:s(s({},t.page),D.buildState())};N.save(U,e)},oe=t=>{let e=JSON.parse(t);W=e.signed,B=st(e.unsigned||{}),dt(),setTimeout(()=>c(E.stateInitialize,document,{detail:B}))};new MutationObserver(dt).observe(document,{attributes:!0,childList:!0,subtree:!0});var g={initialize:oe,buildPageState:D.buildState,get signed(){return W},get unsigned(){return B}};function ne(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16))}var mt={v4:ne};var ct="0.2.1";var ae=self.TurboBoost||{},lt={VERSION:ct,active:!1,confirmation:Q,logger:at,schema:d,events:a,registerEventDelegate:u.register,get eventDelegates(){return u.events}};function ut(t,e){let r=e.getAttribute(d.commandAttribute);return{id:t,name:e.getAttribute(d.commandAttribute),elementId:e.id.length>0?e.id:null,elementAttributes:A.buildAttributePayload(e),startedAt:Date.now(),state:{page:g.buildPageState(),signed:g.signed,unsigned:g.unsigned}}}async function se(t){let e,r={};try{if(e=A.findClosestCommand(t.target),!e||!u.isRegisteredForElement(t.type,e))return;let o=mt.v4(),n=J.find(e),i=p(s({},ut(o,e)),{driver:n.name,frameId:n.frame?n.frame.id:null,src:n.src}),m=await c(a.start,e,{cancelable:!0,detail:i});if(m.defaultPrevented||m.detail.confirmation&&t.defaultPrevented)return c(a.abort,e,{detail:{message:`An event handler for '${a.start}' prevented default behavior and blocked command invocation!`,source:m}});switch(n=J.find(e),i=p(s({},ut(o,e)),{driver:n.name,frameId:n.frame?n.frame.id:null,src:n.src}),O.add(i),["frame","window"].includes(n.name)&&t.preventDefault(),n.name){case"method":return n.invokeCommand(e,i);case"form":return n.invokeCommand(e,i,t);case"frame":return n.invokeCommand(n.frame,i);case"window":return n.invokeCommand(self,i)}}catch(o){c(a.clientError,e,{detail:p(s({},r),{error:o})})}}self.TurboBoost=s({},ae);self.TurboBoost.Commands||(u.handler=se,u.register("click",[`[${d.commandAttribute}]`]),u.register("submit",[`form[${d.commandAttribute}]`]),u.register("toggle",[`details[${d.commandAttribute}]`]),u.register("change",[`input[${d.commandAttribute}]`,`select[${d.commandAttribute}]`,`textarea[${d.commandAttribute}]`]),self.TurboBoost.Commands=lt,self.TurboBoost.State={initialize:g.initialize,get current(){return g.unsigned}});var xr=lt;export{xr as default};
//# sourceMappingURL=commands.js.map
