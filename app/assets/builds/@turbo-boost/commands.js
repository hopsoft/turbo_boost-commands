var re=Object.defineProperty,oe=Object.defineProperties;var ne=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var B=(e,t,r)=>t in e?re(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,a=(e,t)=>{for(var r in t||(t={}))ae.call(t,r)&&B(e,r,t[r]);if(X)for(var r of X(t))se.call(t,r)&&B(e,r,t[r]);return e},u=(e,t)=>oe(e,ne(t));var N=(e,t,r)=>(B(e,typeof t!="symbol"?t+"":t,r),r);var D=class{get element(){return document.querySelector('meta[name="turbo-boost"]')}get token(){return this.element.getAttribute("content")}get busy(){return this.element.dataset.busy==="true"}set busy(t){return this.element.dataset.busy=!!t}},i=new D;var m={start:"turbo-boost:command:start",success:"turbo-boost:command:success",finish:"turbo-boost:command:finish",abort:"turbo-boost:command:abort",clientError:"turbo-boost:command:client-error",serverError:"turbo-boost:command:server-error"},f={stateLoad:"turbo-boost:state:load",stateChange:"turbo-boost:state:change"},b=a(a({},m),f);function d(e,t,r={}){return new Promise(o=>{r=r||{},r.detail=r.detail||{},t=t||document;let n=new CustomEvent(e,u(a({},r),{bubbles:!0}));t.dispatchEvent(n),o(n)})}var O;function k(e,t=null){if(!e||typeof e!="object")return e;let r=new Proxy(e,{deleteProperty(o,n){return delete o[n],d(f.stateChange,i.element,{detail:{state:O}}),!0},set(o,n,c,T){return o[n]=k(c,this),d(f.stateChange,i.element,{detail:{state:O}}),!0}});if(Array.isArray(e))e.forEach((o,n)=>e[n]=k(o,r));else if(typeof e=="object")for(let[o,n]of Object.entries(e))e[o]=k(n,r);return t||(O=r),r}var U=k;var R,g,x,M;function J(){if(!i.element)return E();let e=atob(i.element.dataset.state);x={},g=U(JSON.parse(e)),R=a({},g),delete i.element.dataset.clientStateChange,setTimeout(()=>d(f.stateLoad,i.element,{detail:{state:g}}))}function E(){clearTimeout(M),M=setTimeout(J,10)}R||J();addEventListener("DOMContentLoaded",E);addEventListener("load",E);addEventListener("turbo:load",E);addEventListener("turbo:frame-load",E);addEventListener(m.success,E);addEventListener(f.stateChange,e=>{x={};for(let[t,r]of Object.entries(g))R[t]!==r&&(x[t]=r);i.element.dataset.clientStateChange=!0,i.element.dataset.state=btoa(JSON.stringify(g))});var h={events:f,get current(){return g},get delta(){return x},get payloadChunks(){return btoa(JSON.stringify(x)).match(/.{1,2000}/g)}};function ie(e){let t="<html",r="</html",o=e.indexOf(t),n=e.lastIndexOf(r);if(o>=0&&n>=0){let c=e.slice(e.indexOf(">",o)+1,n);document.documentElement.innerHTML=c}}function de(e){document.body.insertAdjacentHTML("beforeend",e)}var v={append:de,replaceDocument:ie};var L={};function me(e){L[e.id]=e}function ue(e){delete L[e]}var w={add:me,remove:ue,get commands(){return[...Object.values(L)]},get length(){return Object.keys(L).length}};function j(e){e.detail.endedAt=Date.now(),e.detail.milliseconds=e.detail.endedAt-e.detail.startedAt,setTimeout(()=>d(m.finish,e.target,{detail:e.detail}),25)}addEventListener(m.serverError,j);addEventListener(m.success,j);addEventListener(m.finish,e=>w.remove(e.detail.id),!0);var A={events:m};var $={};addEventListener("turbo:before-fetch-request",e=>{let t=e.target.closest("turbo-frame"),{fetchOptions:r}=e.detail;if(i.busy){let o=["text/vnd.turbo-boost.html",r.headers.Accept];o=o.filter(n=>n&&n.trim().length>0).join(", "),r.headers.Accept=o,r.headers["TurboBoost-Token"]=i.token}h.payloadChunks.forEach((o,n)=>{r.headers[`TurboBoost-State-${n.toString().padStart(4,"0")}`]=o})});addEventListener("turbo:before-fetch-response",e=>{let t=e.target.closest("turbo-frame"),{fetchResponse:r}=e.detail;if(t&&($[t.id]=t.src),r.header("TurboBoost")){if(r.statusCode<200||r.statusCode>399){let o=`Server returned a ${r.statusCode} status code! TurboBoost Commands require 2XX-3XX status codes.`;d(A.events.clientError,document,{detail:u(a({},e.detail),{error:o})},!0)}r.header("TurboBoost")==="Append"&&(e.preventDefault(),r.responseText.then(o=>v.append(o)))}});addEventListener("turbo:frame-load",e=>{let t=e.target.closest("turbo-frame");t.dataset.turboBoostSrc=$[t.id]||t.src||t.dataset.turboBoostSrc,delete $[t.id]});var ce={frameAttribute:"data-turbo-frame",methodAttribute:"data-turbo-method",commandAttribute:"data-turbo-command",confirmAttribute:"data-turbo-confirm",turboSubmitStartEvent:"turbo:submit-start"},s=a({},ce);var V={method:e=>Promise.resolve(confirm(e))},le=e=>e.detail.driver==="method",fe=e=>{if(e.detail.driver!=="form")return!1;let t=e.target,r=t.closest("turbo-frame"),o=t.closest(`[${s.frameAttribute}]`);return!!(r||o)},be=e=>le(e)||fe(e);document.addEventListener(m.start,async e=>{let t=e.target.getAttribute(s.confirmAttribute);if(!t||(e.detail.confirmation=!0,be(e)))return;await V.method(t)||e.preventDefault()});var W=V;var p=[],q;function pe(e,t){let r=p.find(o=>o.name===e);return r&&p.splice(p.indexOf(r),1),p=[{name:e,selectors:t},...p],document.removeEventListener(e,q,!0),document.addEventListener(e,q,!0),a({},p.find(o=>o.name===e))}function G(e){return p.find(t=>t.selectors.find(r=>Array.from(document.querySelectorAll(r)).find(o=>o===e)))}function he(e,t){let r=G(t);return r&&r.name===e}var l={register:pe,getRegisteredEventForElement:G,isRegisteredForElement:he,get events(){return[...p]},set handler(e){q=e}};function ve(e){return e.closest(`[${s.commandAttribute}]`)}function ge(e){return e.closest("turbo-frame[src]")||e.closest("turbo-frame[data-turbo-frame-src]")||e.closest("turbo-frame")}function Ee(e,t={}){if(e.tagName.toLowerCase()!=="select")return t.value=e.value||null;if(!e.multiple)return t.value=e.options[e.selectedIndex].value;t.values=Array.from(e.options).reduce((r,o)=>(o.selected&&r.push(o.value),r),[])}function Ce(e){let t=Array.from(e.attributes).reduce((r,o)=>{let n=o.value;return r[o.name]=n,r},{});return t.tag=e.tagName,t.checked=!!e.checked,t.disabled=!!e.disabled,Ee(e,t),delete t.class,delete t.action,delete t.href,delete t[s.commandAttribute],delete t[s.frameAttribute],t}var y={buildAttributePayload:Ce,findClosestCommand:ve,findClosestFrameWithSource:ge};function xe(e){var r;if((e==null?void 0:e.formElement)instanceof HTMLFormElement&&(e==null?void 0:e.body)instanceof URLSearchParams&&((r=e==null?void 0:e.fetchRequest)==null?void 0:r.body)instanceof URLSearchParams){e.formData=new FormData(e.formElement);for(let[o,n]of e.formData.entries())e.fetchRequest.body.set(o,n),e.body.set(o,n);return e}}function Ae(e,t={},r={}){t.token=i.token;let o=e.querySelector('input[name="turbo_boost_command"]')||document.createElement("input");o.type="hidden",o.name="turbo_boost_command",o.value=JSON.stringify(t),e.appendChild(o),xe(r.detail.formSubmission)}var z={invokeCommand:Ae};function ye(e,t={}){let r=document.createElement("a");r.href=e;let o=new URL(r);return o.searchParams.set("turbo_boost_command",JSON.stringify(t)),o}var C={build:ye};function Te(e,t){let r=t.src;t=a({},t),delete t.src,e.src=C.build(r,t)}var P={invokeCommand:Te};function ke(e,t={}){let r=t.src;t=a({},t),delete t.src,delete t.href,e.setAttribute("href",C.build(r,t))}var K={invokeCommand:ke};function Le(e){let t=e.target;d(A.events.abort,document,{detail:u(a({},e.detail),{xhr:t})})}function H(e){let t=e.target;t.getResponseHeader("TurboBoost")==="Append"||t.getResponseHeader("Content-Type").startsWith("text/vnd.turbo-boost.html")?v.append(t.responseText):v.replaceDocument(t.responseText);let o=`Server returned a ${t.status} status code! TurboBoost Commands require 2XX-3XX status codes.`;d(A.events.clientError,document,{detail:u(a({},e.detail),{error:o,xhr:t})},!0)}function we(e){let t=e.target;if(t.status<200||t.status>399)return H(e);let r=t.responseText;t.getResponseHeader("TurboBoost")==="Append"||t.getResponseHeader("Content-Type").startsWith("text/vnd.turbo-boost.html")?v.append(t.responseText):v.replaceDocument(t.responseText)}function Se(e){let t=e.src;e=a({},e),delete e.src;try{let r=new XMLHttpRequest;r.open("GET",C.build(t,e),!0),r.setRequestHeader("Accept","text/vnd.turbo-boost.html, text/html, application/xhtml+xml"),r.setRequestHeader("TurboBoost-Token",i.token),h.payloadChunks.forEach((o,n)=>r.setRequestHeader(`TurboBoost-State-${n.toString().padStart(4,"0")}`,o)),r.addEventListener("abort",Le),r.addEventListener("error",H),r.addEventListener("load",we),r.send()}catch(r){let o=`Unexpected error sending HTTP request! ${r.message}`;H(r,{detail:{message:o}})}}var Q={invokeCommand:Se};function F(e,t){return t=t||{dataset:{}},e.href||t.src||t.dataset.turboBoostSrc||location.href}function Be(e){let t=y.findClosestFrameWithSource(e),{turboFrame:r,turboMethod:o}=e.dataset;return e.tagName.toLowerCase()==="form"?{name:"form",reason:"Element is a form.",frame:t,src:e.action,invokeCommand:z.invokeCommand}:o&&o.length>0?{name:"method",reason:"Element defines data-turbo-method.",frame:t,src:e.href,invokeCommand:K.invokeCommand}:r&&r!=="_self"?(t=document.getElementById(r),{name:"frame",reason:"element targets a frame that is not _self",frame:t,src:F(e,t),invokeCommand:P.invokeCommand}):(!r||r==="_self")&&t?{name:"frame",reason:"element does NOT target a frame or targets _self and is contained by a frame",frame:t,src:F(e,t),invokeCommand:P.invokeCommand}:{name:"window",reason:"element matches one or more of the following conditions (targets _top, does NOT target a frame, is NOT contained by a frame)",frame:null,src:F(e),invokeCommand:Q.invokeCommand}}var _={find:Be};var S="unknown",Y={debug:Object.values(b),info:Object.values(b),warn:[b.abort,b.clientError,b.serverError],error:[b.clientError,b.serverError],unknown:[]};Object.values(b).forEach(e=>{addEventListener(e,t=>{if(Y[S].includes(t.type)){let{target:r,detail:o}=t;console[S](t.type,{target:r,detail:o})}})});var Z={get level(){return S},set level(e){return Object.keys(Y).includes(e)||(e="unknown"),S=e}};function De(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}var ee={v4:De};function I(e){var t;return t=class extends e{invoke(r){r.preventDefault();let o=this.formElement||this.element;this.assignCommand(o);let n=l.getRegisteredEventForElement(o);if(o.addEventListener(n.name,this.reset,{once:!0}),n.name==="submit"&&o.requestSubmit)return o.requestSubmit();d(registeredEvent.name,this.element,{detail:{sourceEvent}})}assignCommand(r){let o=r.getAttribute(s.commandAttribute);r.setAttribute(s.commandAttribute,this.nameValue),r.setAttribute(`${s.commandAttribute}-original`,o)}reset(r){let o=r.target;setTimeout(()=>{o.setAttribute(s.commandAttribute,o.getAttribute(`${s.commandAttribute}-original`)),o.removeAttribute(`${s.commandAttribute}-original`)})}get formElement(){return document.getElementById(this.formValue)}},N(t,"values",{name:String,form:String}),t}function te(e,t){return{id:e,name:t.getAttribute(s.commandAttribute),elementId:t.id.length>0?t.id:null,elementAttributes:y.buildAttributePayload(t),startedAt:Date.now()}}async function Oe(e){let t,r={};try{if(t=y.findClosestCommand(e.target),!t||!l.isRegisteredForElement(e.type,t))return;let o=`turbo-command-${ee.v4()}`,n=_.find(t),c=u(a({},te(o,t)),{driver:n.name,frameId:n.frame?n.frame.id:null,src:n.src}),T=await d(m.start,t,{cancelable:!0,detail:c});if(T.defaultPrevented||T.detail.confirmation&&e.defaultPrevented)return d(m.abort,t,{detail:{message:`An event handler for '${m.start}' prevented default behavior and blocked command invocation!`,source:T}});switch(n=_.find(t),c=u(a({},te(o,t)),{driver:n.name,frameId:n.frame?n.frame.id:null,src:n.src}),w.add(c),["frame","window"].includes(n.name)&&e.preventDefault(),i.busy=!0,setTimeout(()=>i.busy=!1,10),n.name){case"method":return n.invokeCommand(t,c);case"form":return n.invokeCommand(t,c,e);case"frame":return n.invokeCommand(n.frame,c);case"window":return n.invokeCommand(c)}}catch(o){d(m.clientError,t,{detail:u(a({},r),{error:o})})}}self.TurboBoost=self.TurboBoost||{};self.TurboBoost=u(a({},self.TurboBoost),{stateEvents:f,get state(){return h.current},get stateDelta(){return h.delta}});self.TurboBoost.Commands||(l.handler=Oe,l.register("click",[`[${s.commandAttribute}]`]),l.register("submit",[`form[${s.commandAttribute}]`]),l.register(s.turboSubmitStartEvent,[`form[${s.commandAttribute}]`]),l.register("change",[`input[${s.commandAttribute}]`,`select[${s.commandAttribute}]`,`textarea[${s.commandAttribute}]`]),self.TurboBoost.Commands={confirmation:W,logger:Z,schema:s,createCommandController:I,events:m,registerEventDelegate:l.register,get eventDelegates(){return l.events}});var ir=self.TurboBoost.Commands;export{ir as default};
//# sourceMappingURL=commands.js.map
