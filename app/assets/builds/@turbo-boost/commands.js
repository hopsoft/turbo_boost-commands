var ct=Object.defineProperty,mt=Object.defineProperties;var ut=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var lt=Object.prototype.hasOwnProperty,ft=Object.prototype.propertyIsEnumerable;var j=(t,e,r)=>e in t?ct(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,i=(t,e)=>{for(var r in e||(e={}))lt.call(e,r)&&j(t,r,e[r]);if(J)for(var r of J(e))ft.call(e,r)&&j(t,r,e[r]);return t},b=(t,e)=>mt(t,ut(e));var pt="TurboBoost-Command",v={boost:"text/vnd.turbo-boost.html",stream:"text/vnd.turbo-stream.html",html:"text/html",xhtml:"application/xhtml+xml",json:"application/json"},bt=(t={})=>{t=i({},t);let e=(t.Accept||"").split(",").map(r=>r.trim()).filter(r=>r.length);return e.unshift(v.boost,v.stream,v.html,v.xhtml),t.Accept=[...new Set(e)].join(", "),t["Content-Type"]=v.json,t["X-Requested-With"]="XMLHttpRequest",t},gt=t=>{if(t){let[e,r,o]=t.split(", ");return{name:e,status:r,strategy:o}}return{}},p={prepare:bt,tokenize:gt,RESPONSE_HEADER:pt};var ht=t=>{document.body.insertAdjacentHTML("beforeend",t)},vt=t=>{let r=new DOMParser().parseFromString(t,"text/html");TurboBoost.Streams.morph.method(document.documentElement,r.documentElement)},A=(t,e)=>{if(t&&e){if(t.match(/^Append$/i))return ht(e);if(t.match(/^Replace$/i))return vt(e)}};var P={};addEventListener("turbo:before-fetch-response",t=>{let e=t.target.closest("turbo-frame");e!=null&&e.id&&(e!=null&&e.src)&&(P[e.id]=e.src);let{fetchResponse:r}=t.detail,o=r.header(p.RESPONSE_HEADER);if(!o)return;t.preventDefault();let{strategy:n}=p.tokenize(o);r.responseHTML.then(d=>A(n,d))});addEventListener("turbo:frame-load",t=>{let e=t.target.closest("turbo-frame");e.dataset.src=P[e.id]||e.src||e.dataset.src,delete P[e.id]});var Et={frameAttribute:"data-turbo-frame",methodAttribute:"data-turbo-method",commandAttribute:"data-turbo-command",confirmAttribute:"data-turbo-confirm",pageStateAttribute:"data-retain"},s=i({},Et);var a={start:"turbo-boost:command:start",success:"turbo-boost:command:success",finish:"turbo-boost:command:finish",abort:"turbo-boost:command:abort",clientError:"turbo-boost:command:client-error",serverError:"turbo-boost:command:server-error"},u={pageChange:"turbo-boost:state:page-change",stateChange:"turbo-boost:state:change",stateInitialize:"turbo-boost:state:initialize"},me=i(i({},a),u);function c(t,e,r={}){return new Promise(o=>{r=r||{},r.detail=r.detail||{},e=e||document;let n=new CustomEvent(t,b(i({},r),{bubbles:!0}));e.dispatchEvent(n),o(n)})}var S={};function yt(t){S[t.id]=t}function At(t){delete S[t]}var C={add:yt,remove:At,get commands(){return[...Object.values(S)]},get length(){return Object.keys(S).length}};var q={method:t=>Promise.resolve(confirm(t))},St=t=>t.detail.driver==="method",Ct=t=>{if(t.detail.driver!=="form")return!1;let e=t.target,r=e.closest("turbo-frame"),o=e.closest(`[${s.frameAttribute}]`);return!!(r||o)},xt=t=>St(t)||Ct(t);document.addEventListener(a.start,async t=>{let e=t.target.getAttribute(s.confirmAttribute);if(!e||(t.detail.confirmation=!0,xt(t)))return;await q.method(e)||t.preventDefault()});var H=q;var f=[],R;function kt(t,e){let r=f.find(o=>o.name===t);return r&&f.splice(f.indexOf(r),1),f=[{name:t,selectors:e},...f],document.removeEventListener(t,R,!0),document.addEventListener(t,R,!0),i({},f.find(o=>o.name===t))}function wt(t){return f.find(e=>e.selectors.find(r=>Array.from(document.querySelectorAll(r)).find(o=>o===t)))}function Lt(t,e){let r=wt(e);return r&&r.name===t}var l={register:kt,isRegisteredForElement:Lt,get events(){return[...f]},set handler(t){R=t}};function Ot(t){return t.closest(`[${s.commandAttribute}]`)}function Tt(t){return t.closest("turbo-frame[src]")||t.closest("turbo-frame[data-turbo-frame-src]")||t.closest("turbo-frame")}function Pt(t,e={}){if(t.tagName.toLowerCase()!=="select")return e.value=t.value||null;if(!t.multiple)return e.value=t.options[t.selectedIndex].value;e.values=Array.from(t.options).reduce((r,o)=>(o.selected&&r.push(o.value),r),[])}function Rt(t){let e=Array.from(t.attributes).reduce((r,o)=>{let n=o.value;return r[o.name]=n,r},{});return e.tag=t.tagName,e.checked=!!t.checked,e.disabled=!!t.disabled,Pt(t,e),delete e.class,delete e.action,delete e.href,delete e[s.commandAttribute],delete e[s.frameAttribute],e}var E={buildAttributePayload:Rt,findClosestCommand:Ot,findClosestFrameWithSource:Tt};var $t=(t,e={})=>{let r=t.querySelector('input[name="turbo_boost_command"]')||document.createElement("input");r.type="hidden",r.name="turbo_boost_command",r.value=JSON.stringify(e),t.contains(r)||t.appendChild(r)},U={invokeCommand:$t};function Nt(t){setTimeout(()=>c(a.finish,t.target,{detail:t.detail}))}var _t=[a.abort,a.serverError,a.success];_t.forEach(t=>addEventListener(t,Nt));addEventListener(a.finish,t=>C.remove(t.detail.id),!0);var V={events:a};var Dt=t=>{let e=document.createElement("a");return e.href=t,new URL(e)},W={get commandInvocationURL(){return Dt("/turbo-boost-command-invocation")}};var X=t=>{let e=`Unexpected error performing a TurboBoost Command! ${t.message}`;c(V.events.clientError,document,{detail:{message:e,error:t}},!0)},It=t=>{let{strategy:e}=p.tokenize(t.headers.get(p.RESPONSE_HEADER));t.text().then(r=>A(e,r))},x=(t={})=>{try{fetch(W.commandInvocationURL.href,{method:"POST",headers:p.prepare({}),body:JSON.stringify(t)}).then(It).catch(X)}catch(e){X(e)}};var Bt=(t,e)=>x(e),$={invokeCommand:Bt};var y,N,zt=()=>{y=null,N=null},Mt=(t,e={})=>{y=t,N=e},Ft=t=>{try{if(!y||t.getAttribute("method")!==y.dataset.turboMethod||t.getAttribute("action")!==y.href)return;let e=t.querySelector('input[name="turbo_boost_command"]')||document.createElement("input");e.type="hidden",e.name="turbo_boost_command",e.value=JSON.stringify(N),t.contains(e)||t.appendChild(e)}finally{zt()}};document.addEventListener("submit",t=>Ft(t.target),!0);var K={invokeCommand:Mt};var Jt=(t,e={})=>x(e),G={invokeCommand:Jt};function _(t,e){return e=e||{dataset:{}},t.href||e.src||e.dataset.src||location.href}function jt(t){let e=E.findClosestFrameWithSource(t),{turboFrame:r,turboMethod:o}=t.dataset;return t.tagName.toLowerCase()==="form"?{name:"form",reason:"Element is a form.",frame:e,src:t.action,invokeCommand:U.invokeCommand}:o&&o.length>0?{name:"method",reason:"Element defines data-turbo-method.",frame:e,src:t.href,invokeCommand:K.invokeCommand}:r&&r!=="_self"?(e=document.getElementById(r),{name:"frame",reason:"element targets a frame that is not _self",frame:e,src:_(t,e),invokeCommand:$.invokeCommand}):(!r||r==="_self")&&e?{name:"frame",reason:"element does NOT target a frame or targets _self and is contained by a frame",frame:e,src:_(t,e),invokeCommand:$.invokeCommand}:{name:"window",reason:"element matches one or more of the following conditions (targets _top, does NOT target a frame, is NOT contained by a frame)",frame:null,src:_(t),invokeCommand:G.invokeCommand}}var D={find:jt};var w="unknown",Q=!1,k=[],g={debug:Object.values(a),info:Object.values(a),warn:[a.abort,a.clientError,a.serverError],error:[a.clientError,a.serverError],unknown:[]},qt=t=>{if(!g[w].includes(t.type)||typeof console[w]!="function")return!1;let{detail:e}=t;if(!e.id)return!0;let r=`${t.type}-${e.id}`;return k.includes(r)?!1:(k.length>16&&k.shift(),k.push(r),!0)},Ht=t=>g.error.includes(t.type)?"error":g.warn.includes(t.type)?"warn":g.info.includes(t.type)?"info":g.debug.includes(t.type)?"debug":"log",Ut=t=>{if(qt(t)){let{target:e,type:r,detail:o}=t,n=o.id||"",d=o.name||"",m="";o.startedAt&&(m=`${Date.now()-o.startedAt}ms `);let M=r.split(":"),it=M.pop(),F=`%c${M.join(":")}:%c${it}`,dt=[`%c${d}`,`%c${m}`,F];console[Ht(t)](dt.join(" ").replace(/\s{2,}/g," "),"color:deepskyblue","color:lime","color:darkgray",F.match(/abort|error/i)?"color:red":"color:deepskyblue",{id:n,detail:o,target:e})}};Q||(Q=!0,Object.values(a).forEach(t=>addEventListener(t,e=>Ut(e))));var Y={get level(){return w},set level(t){return Object.keys(g).includes(t)||(t="unknown"),w=t}};var I;function L(t,e=null){if(!t||typeof t!="object")return t;let r=new Proxy(t,{deleteProperty(o,n){return delete o[n],c(u.stateChange,document,{detail:{state:I}}),!0},set(o,n,d,m){return o[n]=L(d,this),c(u.stateChange,document,{detail:{state:I}}),!0}});if(Array.isArray(t))t.forEach((o,n)=>t[n]=L(o,r));else if(typeof t=="object")for(let[o,n]of Object.entries(t))t[o]=L(n,r);return e||(I=r),r}var Z=L;function Vt(t,e){t.forEach(r=>{if(r.type==="attributes"&&r.target.hasAttribute(s.pageStateAttribute)){console.log("attribute changed",r.attributeName,r);let o=r.target.getAttribute(s.pageStateAttribute);JSON.parse(o).includes(r.attributeName)&&c(u.pageChange,r.target)}})}new MutationObserver(Vt).observe(document.documentElement,{attributeOldValue:!1,attributes:!0,childList:!0,subtree:!0});function Wt(t={}){console.log("restoreState",t)}function Xt(){return Array.from(document.querySelectorAll(`[id][${s.pageStateAttribute}]`)).reduce((e,r)=>{try{let o=r.id.trim(),n=JSON.parse(r.getAttribute(s.pageStateAttribute));if(o.length===0||n.length===0)return e;e[o]=n.reduce((d,m)=>(r.hasAttribute(m)&&(d[m]=r.getAttribute(m)||m),d),{})}catch(o){let n=`
        The element with id ${key} has an invalid value assigned to: ${s.optimisticPageStateAttribute}
        To participate in 'optimistic page state', elements must have a value that is a valid JSON string
        with an array of safe attribute names to observe.`;c(a.clientError,r,{detail:{message:n}})}return e},{})}var O={buildState:Xt,restoreState:Wt};function Kt(t,e){return typeof e!="object"&&(e={}),sessionStorage.setItem(String(t),JSON.stringify(e))}function Gt(t){let e=sessionStorage.getItem(String(t));return e?JSON.parse(e):{}}var tt={save:Kt,find:Gt};var Qt="TurboBoost::State",B=null,z={},et,rt;if(!et){let t={};et=addEventListener("DOMContentLoaded",()=>{O.restoreState(t)})}rt||(rt=addEventListener(u.pageChange,T));var T=()=>{let t=i({pageState:O.buildState(),signedState:B},z);console.log("saveState",u,t),tt.save(Qt,t)};function Yt(t){removeEventListener(u.stateChange,T);let e=JSON.parse(t),{signed:r,unsigned:o}=e;B=r,z=Z(o||{}),addEventListener(u.stateChange,T),T(),setTimeout(()=>c(u.stateInitialize,document,{detail:o}))}var h={initialize:Yt,buildPageState:O.buildState,get signed(){return B},get unsigned(){return z}};function Zt(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16))}var ot={v4:Zt};var nt="0.2.1";var te=self.TurboBoost||{},st={VERSION:nt,active:!1,confirmation:H,logger:Y,schema:s,events:a,registerEventDelegate:l.register,get eventDelegates(){return l.events}};function at(t,e){let r=e.getAttribute(s.commandAttribute);return{id:t,name:e.getAttribute(s.commandAttribute),elementId:e.id.length>0?e.id:null,elementAttributes:E.buildAttributePayload(e),startedAt:Date.now(),state:{page:h.buildPageState(),signed:h.signed,unsigned:h.unsigned}}}async function ee(t){let e,r={};try{if(e=E.findClosestCommand(t.target),!e||!l.isRegisteredForElement(t.type,e))return;let o=ot.v4(),n=D.find(e),d=b(i({},at(o,e)),{driver:n.name,frameId:n.frame?n.frame.id:null,src:n.src}),m=await c(a.start,e,{cancelable:!0,detail:d});if(m.defaultPrevented||m.detail.confirmation&&t.defaultPrevented)return c(a.abort,e,{detail:{message:`An event handler for '${a.start}' prevented default behavior and blocked command invocation!`,source:m}});switch(n=D.find(e),d=b(i({},at(o,e)),{driver:n.name,frameId:n.frame?n.frame.id:null,src:n.src}),C.add(d),["frame","window"].includes(n.name)&&t.preventDefault(),n.name){case"method":return n.invokeCommand(e,d);case"form":return n.invokeCommand(e,d,t);case"frame":return n.invokeCommand(n.frame,d);case"window":return n.invokeCommand(self,d)}}catch(o){c(a.clientError,e,{detail:b(i({},r),{error:o})})}}self.TurboBoost=i({},te);self.TurboBoost.Commands||(l.handler=ee,l.register("click",[`[${s.commandAttribute}]`]),l.register("submit",[`form[${s.commandAttribute}]`]),l.register("toggle",[`details[${s.commandAttribute}]`]),l.register("change",[`input[${s.commandAttribute}]`,`select[${s.commandAttribute}]`,`textarea[${s.commandAttribute}]`]),self.TurboBoost.Commands=st,self.TurboBoost.State={initialize:h.initialize,get current(){return h.unsigned}});var vr=st;export{vr as default};
//# sourceMappingURL=commands.js.map
