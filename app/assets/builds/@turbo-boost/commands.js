var Z=Object.defineProperty,tt=Object.defineProperties;var et=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var rt=Object.prototype.hasOwnProperty,ot=Object.prototype.propertyIsEnumerable;var M=(t,e,r)=>e in t?Z(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,a=(t,e)=>{for(var r in e||(e={}))rt.call(e,r)&&M(t,r,e[r]);if(B)for(var r of B(e))ot.call(e,r)&&M(t,r,e[r]);return t},p=(t,e)=>tt(t,et(e));var nt={frameAttribute:"data-turbo-frame",methodAttribute:"data-turbo-method",commandAttribute:"data-turbo-command",confirmAttribute:"data-turbo-confirm"},i=a({},nt);var s={start:"turbo-boost:command:start",success:"turbo-boost:command:success",finish:"turbo-boost:command:finish",abort:"turbo-boost:command:abort",clientError:"turbo-boost:command:client-error",serverError:"turbo-boost:command:server-error"},u={stateLoad:"turbo-boost:state:load",stateChange:"turbo-boost:state:change"},c=a(a({},s),u);function m(t,e,r={}){return new Promise(o=>{r=r||{},r.detail=r.detail||{},e=e||document;let n=new CustomEvent(t,p(a({},r),{bubbles:!0}));e.dispatchEvent(n),o(n)})}var E={};function at(t){E[t.id]=t}function it(t){delete E[t]}var y={add:at,remove:it,get commands(){return[...Object.values(E)]},get length(){return Object.keys(E).length}};var I={method:t=>Promise.resolve(confirm(t))},st=t=>t.detail.driver==="method",mt=t=>{if(t.detail.driver!=="form")return!1;let e=t.target,r=e.closest("turbo-frame"),o=e.closest(`[${i.frameAttribute}]`);return!!(r||o)},dt=t=>st(t)||mt(t);document.addEventListener(s.start,async t=>{let e=t.target.getAttribute(i.confirmAttribute);if(!e||(t.detail.confirmation=!0,dt(t)))return;await I.method(e)||t.preventDefault()});var F=I;var l=[],S;function ct(t,e){let r=l.find(o=>o.name===t);return r&&l.splice(l.indexOf(r),1),l=[{name:t,selectors:e},...l],document.removeEventListener(t,S,!0),document.addEventListener(t,S,!0),a({},l.find(o=>o.name===t))}function ut(t){return l.find(e=>e.selectors.find(r=>Array.from(document.querySelectorAll(r)).find(o=>o===t)))}function lt(t,e){let r=ut(e);return r&&r.name===t}var f={register:ct,isRegisteredForElement:lt,get events(){return[...l]},set handler(t){S=t}};function H(t){t.detail.endedAt=Date.now(),t.detail.milliseconds=t.detail.endedAt-t.detail.startedAt,setTimeout(()=>m(s.finish,t.target,{detail:t.detail}),25)}addEventListener(s.serverError,H);addEventListener(s.success,H);addEventListener(s.finish,t=>y.remove(t.detail.id),!0);var L={events:s};function ft(t){return t.closest(`[${i.commandAttribute}]`)}function pt(t){return t.closest("turbo-frame[src]")||t.closest("turbo-frame[data-turbo-frame-src]")||t.closest("turbo-frame")}function bt(t,e={}){if(t.tagName.toLowerCase()!=="select")return e.value=t.value||null;if(!t.multiple)return e.value=t.options[t.selectedIndex].value;e.values=Array.from(t.options).reduce((r,o)=>(o.selected&&r.push(o.value),r),[])}function vt(t){let e=Array.from(t.attributes).reduce((r,o)=>{let n=o.value;return r[o.name]=n,r},{});return e.tag=t.tagName,e.checked=!!t.checked,e.disabled=!!t.disabled,bt(t,e),delete e.class,delete e.action,delete e.href,delete e[i.commandAttribute],delete e[i.frameAttribute],e}var b={buildAttributePayload:vt,findClosestCommand:ft,findClosestFrameWithSource:pt};function ht(t,e={},r={}){let o=t.querySelector('input[name="turbo_boost_command"]')||document.createElement("input");o.type="hidden",o.name="turbo_boost_command",o.value=JSON.stringify(e),t.appendChild(o)}var N={invokeCommand:ht};var gt="TurboBoost-Command",v={boost:"text/vnd.turbo-boost.html",stream:"text/vnd.turbo-stream.html",html:"text/html",xhtml:"application/xhtml+xml",json:"application/json"},Et=(t={})=>{t=a({},t);let e=(t.Accept||"").split(",").map(r=>r.trim()).filter(r=>r.length);return e.unshift(v.boost,v.stream,v.html,v.xhtml),t.Accept=[...new Set(e)].join(", "),t["Content-Type"]=v.json,t["X-Requested-With"]="XMLHttpRequest",t},yt=t=>{if(t){let[e,r,o]=t.split(", ");return{status:e,strategy:r,name:o}}return{}},x={prepare:Et,tokenize:yt,RESPONSE_HEADER:gt};var T;function C(t,e=null){if(!t||typeof t!="object")return t;let r=new Proxy(t,{deleteProperty(o,n){return delete o[n],m(u.stateChange,document,{detail:{state:T}}),!0},set(o,n,d,g){return o[n]=C(d,this),m(u.stateChange,document,{detail:{state:T}}),!0}});if(Array.isArray(t))t.forEach((o,n)=>t[n]=C(o,r));else if(typeof t=="object")for(let[o,n]of Object.entries(t))t[o]=C(n,r);return e||(T=r),r}var j=C;var O,A,R,U;function xt(t,e){let r=JSON.parse(t);O=a({},r),U=e,A=j(r),R={},setTimeout(()=>m(u.stateLoad,document,{detail:{state:A}}))}addEventListener(u.stateChange,t=>{for(let[e,r]of Object.entries(A))O[e]!==r&&(R[e]=r)});var h={initialize:xt,events:u,get initial(){return O},get current(){return A},get changed(){return R},get signed(){return U}};var Ct=t=>{let e=document.createElement("a");return e.href=t,new URL(e)},X={get commandInvocationURL(){return Ct("/turbo-boost-command-invocation")}};var At=t=>{document.body.insertAdjacentHTML("beforeend",t)},kt=t=>{let r=new DOMParser().parseFromString(t,"text/html");document.head.innerHTML=r.head.innerHTML,document.body.innerHTML=r.body.innerHTML},D=(t,e)=>{if(t.match(/^Append$/i))return At(e);if(t.match(/^Replace$/i))return kt(e)};var q=t=>{let e=`Unexpected error performing a TurboBoost Command! ${t.message}`;m(L.events.clientError,document,{detail:{error:e}},!0)},wt=t=>{let e=t.status>=200&&t.status<=399,r=x.tokenize(t.headers.get(x.RESPONSE_HEADER)).strategy;if(e)return t.text().then(n=>D(r,n));let o=`Server returned a ${t.status} status code! TurboBoost Commands require 2XX-3XX status codes.`;m(L.events.clientError,document,{detail:{error:o,response:t}},!0),t.text().then(n=>D(r,n))},k=(t={})=>{try{fetch(X.commandInvocationURL.href,{method:"POST",headers:x.prepare({}),body:JSON.stringify(t)}).then(wt).catch(q)}catch(e){q(e)}};var St=(t,e)=>k(e),P={invokeCommand:St};function Lt(t,e={}){}var z={invokeCommand:Lt};var Tt=(t,e={})=>k(e),J={invokeCommand:Tt};function _(t,e){return e=e||{dataset:{}},t.href||e.src||e.dataset.turboBoostSrc||location.href}function Ot(t){let e=b.findClosestFrameWithSource(t),{turboFrame:r,turboMethod:o}=t.dataset;return t.tagName.toLowerCase()==="form"?{name:"form",reason:"Element is a form.",frame:e,src:t.action,invokeCommand:N.invokeCommand}:o&&o.length>0?{name:"method",reason:"Element defines data-turbo-method.",frame:e,src:t.href,invokeCommand:z.invokeCommand}:r&&r!=="_self"?(e=document.getElementById(r),{name:"frame",reason:"element targets a frame that is not _self",frame:e,src:_(t,e),invokeCommand:P.invokeCommand}):(!r||r==="_self")&&e?{name:"frame",reason:"element does NOT target a frame or targets _self and is contained by a frame",frame:e,src:_(t,e),invokeCommand:P.invokeCommand}:{name:"window",reason:"element matches one or more of the following conditions (targets _top, does NOT target a frame, is NOT contained by a frame)",frame:null,src:_(t),invokeCommand:J.invokeCommand}}var $={find:Ot};var w="unknown",V={debug:Object.values(c),info:Object.values(c),warn:[c.abort,c.clientError,c.serverError],error:[c.clientError,c.serverError],unknown:[]};Object.values(c).forEach(t=>{addEventListener(t,e=>{if(V[w].includes(e.type)){let{target:r,detail:o}=e;console[w](e.type,{target:r,detail:o})}})});var W={get level(){return w},set level(t){return Object.keys(V).includes(t)||(t="unknown"),w=t}};function Rt(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16))}var G={v4:Rt};var K="0.1.2";var Dt=self.TurboBoost||{},Y={VERSION:K,active:!1,confirmation:F,logger:W,schema:i,events:s,registerEventDelegate:f.register,get eventDelegates(){return f.events}};function Q(t,e){return{id:t,name:e.getAttribute(i.commandAttribute),elementId:e.id.length>0?e.id:null,elementAttributes:b.buildAttributePayload(e),startedAt:Date.now(),changedState:h.changed,clientState:h.current,signedState:h.signed}}async function Pt(t){let e,r={};try{if(e=b.findClosestCommand(t.target),!e||!f.isRegisteredForElement(t.type,e))return;let o=`turbo-command-${G.v4()}`,n=$.find(e),d=p(a({},Q(o,e)),{driver:n.name,frameId:n.frame?n.frame.id:null,src:n.src}),g=await m(s.start,e,{cancelable:!0,detail:d});if(g.defaultPrevented||g.detail.confirmation&&t.defaultPrevented)return m(s.abort,e,{detail:{message:`An event handler for '${s.start}' prevented default behavior and blocked command invocation!`,source:g}});switch(n=$.find(e),d=p(a({},Q(o,e)),{driver:n.name,frameId:n.frame?n.frame.id:null,src:n.src}),y.add(d),["frame","window"].includes(n.name)&&t.preventDefault(),n.name){case"method":return n.invokeCommand(e,d);case"form":return n.invokeCommand(e,d,t);case"frame":return n.invokeCommand(n.frame,d);case"window":return n.invokeCommand(self,d)}}catch(o){m(s.clientError,e,{detail:p(a({},r),{error:o})})}}self.TurboBoost=a({},Dt);self.TurboBoost.Commands||(f.handler=Pt,f.register("click",[`[${i.commandAttribute}]`]),f.register("submit",[`form[${i.commandAttribute}]`]),f.register("change",[`input[${i.commandAttribute}]`,`select[${i.commandAttribute}]`,`textarea[${i.commandAttribute}]`]),self.TurboBoost.Commands=Y,self.TurboBoost.State=h);var ze=Y;export{ze as default};
//# sourceMappingURL=commands.js.map
