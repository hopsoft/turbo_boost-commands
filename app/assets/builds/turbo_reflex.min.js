var l={beforeStart:"turbo-reflex:before-start",start:"turbo-reflex:start",finish:"turbo-reflex:finish",error:"turbo-reflex:error",missingFrameId:"turbo-reflex:missing-frame-id",missingFrame:"turbo-reflex:missing-frame",missingFrameSrc:"turbo-reflex:missing-frame-src"};function y(e,t=document,r={}){let n=new CustomEvent(e,{detail:r,cancelable:!0,bubbles:!0});t.dispatchEvent(n)}function L(){Object.values(l).forEach(e=>console.log(e))}var o={...l,dispatch:y,logEventNames:L};var u={};addEventListener("turbo:before-fetch-response",e=>{let t=e.target;u[t.id]=t.src;let{turboReflexActive:r,turboReflexElementId:n}=t.dataset;if(!r)return;let s=document.getElementById(n);delete t.dataset.turboReflexActive,delete t.dataset.turboReflexElementId,o.dispatch(o.finish,s||document,{frame:t,element:s||"Unknown! Missing id attribute."})});addEventListener("turbo:frame-load",e=>{let t=e.target;t.dataset.turboReflexSrc=u[t.id]||t.src||t.dataset.turboReflexSrc,delete u[t.id]});var S={get token(){return document.getElementById("turbo-reflex-token").getAttribute("content")}},d=S;function m(e){return e.closest("[data-turbo-reflex]")}function F(e){return e.closest("turbo-frame")}function b(e){let t=e.dataset.turboReflexFrame||e.dataset.turboFrame;if(!t){let r=F(e);r&&(t=r.id)}return t||(console.error("The reflex element does not specify a frame!","Please move the reflex element inside a <turbo-frame> or set the 'data-turbo-reflex-frame' or 'data-turbo-frame' attribute.",e),o.dispatch(o.missingFrameId,e,{element:e})),t}function g(e){let t=document.getElementById(e);return t||(console.error(`The frame '${e}' does not exist!`),o.dispatch(o.missingFrame,document,{id:e})),t}function x(e){let t=e.dataset.turboReflexSrc||e.src;return t||(console.error(`The the 'src' for <turbo-frame id='${e.id}'> is unknown!`,"TurboReflex uses 'src' to (re)render frame content after the reflex is invoked.","Please set the 'src' or 'data-turbo-reflex-src' attribute on the <turbo-frame> element.",e),o.dispatch(o.missingFrameSrc,e,{frame:e})),t}function p(e){let{tagName:t,value:r}=e,n=t.toLowerCase(),s=Array.from(e.attributes).reduce((i,a)=>(i[a.name]=a.value,i),{});return s.tagName=t,s.value=r||null,n==="select"&&(e.multiple?s.values=Array.from(e.options).reduce((i,a)=>(a.selected&&i.push(a.value),i),[]):s.value=e.options[e.selectedIndex].value),n==="input"&&e.type==="checkbox"&&(s.checked=!!e.checked),s}var c={},v;function h(e){v=e}function f(e,t){c[e]=t,document.addEventListener(e,v,!0)}function E(e,t){return t=t.toLowerCase(),c[e].includes(t)||!Object.values(c).flat().includes(t)&&c[e].includes("*")}function R(){console.log(c)}addEventListener("turbo:before-fetch-request",e=>{let t=e.target,{turboReflexActive:r}=t.dataset;if(!r)return;let{fetchOptions:n}=e.detail;n.headers["Turbo-Reflex"]=d.token});function k(e){let t=document.createElement("a");return t.href=e,new URL(t)}function I(e){let t,r,n,s;try{if(t=m(e.target),!t||!E(e.type,t.tagName)||(o.dispatch(o.beforeStart,t,{element:t}),r=b(t),!r)||(n=g(r),!n)||(s=x(n),!s))return;let i={frameId:r,element:p(t)};if(o.dispatch(o.start,t,{element:t,frameId:r,frame:n,frameSrc:s,payload:i}),n.dataset.turboReflexActive=!0,n.dataset.turboReflexElementId=t.id,t.tagName.toLowerCase()==="form"){i.token=d.token;let a=document.createElement("input");a.type="hidden",a.name="turbo_reflex",a.value=JSON.stringify(i),t.appendChild(a)}else{e.preventDefault();let a=k(s);a.searchParams.set("turbo_reflex",JSON.stringify(i)),n.src=a.toString()}}catch(i){console.error("TurboReflex encountered an unexpected error!",{element:t,frameId:r,frame:n,frameSrc:s,target:e.target},i),o.dispatch(o.error,t||document,{element:t,frameId:r,frame:n,frameSrc:s,error:i})}}h(I);f("change",["input","select","textarea"]);f("submit",["form"]);f("click",["*"]);var q={registerEvent:f,logRegisteredEvents:R,logLifecycleEventNames:o.logEventNames};export{q as default};
//# sourceMappingURL=turbo_reflex.min.js.map
