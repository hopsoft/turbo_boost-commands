var l={beforeStart:"turbo-reflex:before-start",start:"turbo-reflex:start",finish:"turbo-reflex:finish",error:"turbo-reflex:error",missingFrameId:"turbo-reflex:missing-frame-id",missingFrame:"turbo-reflex:missing-frame",missingFrameSrc:"turbo-reflex:missing-frame-src"};function y(e,t=document,r={}){let n=new CustomEvent(e,{detail:r,cancelable:!0,bubbles:!0});t.dispatchEvent(n)}function S(){Object.values(l).forEach(e=>console.log(e))}var s={...l,dispatch:y,logEventNames:S};var c={};addEventListener("turbo:before-fetch-response",e=>{let t=e.target;c[t.id]=t.src;let{turboReflexActive:r,turboReflexElementId:n}=t.dataset;if(!r)return;let o=document.getElementById(n);delete t.dataset.turboReflexActive,delete t.dataset.turboReflexElementId,s.dispatch(s.finish,o||document,{frame:t,element:o||"Unknown! Missing id attribute."})});addEventListener("turbo:frame-load",e=>{let t=e.target;t.dataset.turboReflexSrc=c[t.id]||t.src||t.dataset.turboReflexSrc,delete c[t.id]});addEventListener("turbo:before-stream-render",e=>{let r=e.target.templateContent.querySelector("turbo-frame");if(!r)return;let n=r.id;setTimeout(()=>{let o=document.getElementById(n);o.dataset.turboReflexSrc=c[r.id]||o.src||o.dataset.turboReflexSrc,delete c[n]},100)});var L={get token(){return document.getElementById("turbo-reflex-token").getAttribute("content")}},d=L;function m(e){return e.closest("[data-turbo-reflex]")}function F(e){return e.closest("turbo-frame")}function b(e){let t=e.dataset.turboReflexFrame||e.dataset.turboFrame;if(!t){let r=F(e);r&&(t=r.id)}return t||(console.error("The reflex element does not specify a frame!","Please move the reflex element inside a <turbo-frame> or set the 'data-turbo-reflex-frame' or 'data-turbo-frame' attribute.",e),s.dispatch(s.missingFrameId,e,{element:e})),t}function g(e){let t=document.getElementById(e);return t||(console.error(`The frame '${e}' does not exist!`),s.dispatch(s.missingFrame,document,{id:e})),t}function x(e){let t=e.dataset.turboReflexSrc||e.src;return t||(console.error(`The the 'src' for <turbo-frame id='${e.id}'> is unknown!`,"TurboReflex uses 'src' to (re)render frame content after the reflex is invoked.","Please set the 'src' or 'data-turbo-reflex-src' attribute on the <turbo-frame> element.",e),s.dispatch(s.missingFrameSrc,e,{frame:e})),t}function p(e){let{tagName:t,value:r}=e,n=t.toLowerCase(),o=Array.from(e.attributes).reduce((a,i)=>(a[i.name]=i.value,a),{});return o.tagName=t,o.value=r||null,n==="select"&&(e.multiple?o.values=Array.from(e.options).reduce((a,i)=>(i.selected&&a.push(i.value),a),[]):o.value=e.options[e.selectedIndex].value),n==="input"&&e.type==="checkbox"&&(o.checked=!!e.checked),o}var f={},v;function h(e){v=e}function u(e,t){f[e]=t,document.addEventListener(e,v,!0)}function E(e,t){return t=t.toLowerCase(),f[e].includes(t)||!Object.values(f).flat().includes(t)&&f[e].includes("*")}function R(){console.log(f)}addEventListener("turbo:before-fetch-request",e=>{let t=e.target,{turboReflexActive:r}=t.dataset;if(!r)return;let{fetchOptions:n}=e.detail;n.headers["Turbo-Reflex"]=d.token});function I(e){let t=document.createElement("a");return t.href=e,new URL(t)}function k(e){let t,r,n,o;try{if(t=m(e.target),!t||!E(e.type,t.tagName)||(s.dispatch(s.beforeStart,t,{element:t}),r=b(t),!r)||(n=g(r),!n)||(o=x(n),!o))return;let a={frameId:r,element:p(t)};if(s.dispatch(s.start,t,{element:t,frameId:r,frame:n,frameSrc:o,payload:a}),n.dataset.turboReflexActive=!0,n.dataset.turboReflexElementId=t.id,t.tagName.toLowerCase()==="form"){a.token=d.token;let i=document.createElement("input");i.type="hidden",i.name="turbo_reflex",i.value=JSON.stringify(a),t.appendChild(i)}else{e.preventDefault();let i=I(o);i.searchParams.set("turbo_reflex",JSON.stringify(a)),n.src=i.toString()}}catch(a){console.error("TurboReflex encountered an unexpected error!",{element:t,frameId:r,frame:n,frameSrc:o,target:e.target},a),s.dispatch(s.error,t||document,{element:t,frameId:r,frame:n,frameSrc:o,error:a})}}h(k);u("change",["input","select","textarea"]);u("submit",["form"]);u("click",["*"]);var $={registerEvent:u,logRegisteredEvents:R,logLifecycleEventNames:s.logEventNames};export{$ as default};
//# sourceMappingURL=turbo_reflex.min.js.map
