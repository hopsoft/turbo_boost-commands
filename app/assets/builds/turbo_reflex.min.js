var l={beforeStart:"turbo-reflex:before-start",start:"turbo-reflex:start",finish:"turbo-reflex:finish",error:"turbo-reflex:error",missingFrameId:"turbo-reflex:missing-frame-id",missingFrame:"turbo-reflex:missing-frame",missingFrameSrc:"turbo-reflex:missing-frame-src"};function y(e,t=document,r={}){let n=new CustomEvent(e,{detail:r,cancelable:!0,bubbles:!0});t.dispatchEvent(n)}function L(){Object.values(l).forEach(e=>console.log(e))}var o={...l,dispatch:y,logEventNames:L};var u={};addEventListener("turbo:before-fetch-response",e=>{let t=e.target;u[t.id]=t.src;let{turboReflexActive:r,turboReflexElementId:n}=t.dataset;if(!r)return;let s=document.getElementById(n);delete t.dataset.turboReflexActive,delete t.dataset.turboReflexElementId,o.dispatch(o.finish,s||document,{frame:t,element:s||"Unknown! Missing id attribute."})});addEventListener("turbo:frame-load",e=>{let t=e.target;t.dataset.turboReflexSrc=u[t.id]||t.src||t.dataset.turboReflexSrc,delete u[t.id]});var F={get token(){return document.getElementById("turbo-reflex-token").getAttribute("content")}},c=F;function m(e){return e.closest("[data-turbo-reflex]")}function S(e){return e.closest("turbo-frame")}function b(e){let t=e.dataset.turboReflexFrame||e.dataset.turboFrame;if(!t){let r=S(e);r&&(t=r.id)}return t||(console.error("The reflex element does not specify a frame!","Please move the reflex element inside a <turbo-frame> or set the 'data-turbo-reflex-frame' or 'data-turbo-frame' attribute.",e),o.dispatch(o.missingFrameId,e,{element:e})),t}function g(e){let t=document.getElementById(e);return t||(console.error(`The frame '${e}' does not exist!`),o.dispatch(o.missingFrame,document,{id:e})),t}function x(e){let t=e.dataset.turboReflexSrc||e.src;return t||(console.error(`The the 'src' for <turbo-frame id='${e.id}'> is unknown!`,"TurboReflex uses 'src' to (re)render frame content after the reflex is invoked.","Please set the 'src' or 'data-turbo-reflex-src' attribute on the <turbo-frame> element.",e),o.dispatch(o.missingFrameSrc,e,{frame:e})),t}function k(e,t={}){if(e.tagName.toLowerCase()!=="select")return t.value=e.value;if(!e.multiple)return t.value=e.options[e.selectedIndex].value;t.values=Array.from(e.options).reduce((r,n)=>(n.selected&&r.push(n.value),r),[])}function v(e){let t=e.tagName.toLowerCase(),r=Array.from(e.attributes).reduce((n,s)=>(n[s.name]=s.value,n),{});return r.tag=t,r.checked=e.checked,r.disabled=e.disabled,k(e,r),r}var a={},h;function p(e){h=e}function f(e,t){a[e]=t,document.addEventListener(e,h,!0)}function E(e,t){return t=t.toLowerCase(),a[e].includes(t)||!Object.values(a).flat().includes(t)&&a[e].includes("*")}function R(){console.log(a)}addEventListener("turbo:before-fetch-request",e=>{let t=e.target,{turboReflexActive:r}=t.dataset;if(!r)return;let{fetchOptions:n}=e.detail;n.headers["Turbo-Reflex"]=c.token});function I(e){let t=document.createElement("a");return t.href=e,new URL(t)}function C(e,t={}){t.token=c.token;let r=document.createElement("input");r.type="hidden",r.name="turbo_reflex",r.value=JSON.stringify(t),e.appendChild(r)}function A(e){let t,r,n,s;try{if(t=m(e.target),!t||!E(e.type,t.tagName)||(o.dispatch(o.beforeStart,t,{element:t}),r=b(t),!r)||(n=g(r),!n)||(s=x(n),!s))return;let i={frameId:r,element:v(t)};if(o.dispatch(o.start,t,{element:t,frameId:r,frame:n,frameSrc:s,payload:i}),n.dataset.turboReflexActive=!0,n.dataset.turboReflexElementId=t.id,t.tagName.toLowerCase()==="form")return C(t,i);e.preventDefault();let d=I(s);d.searchParams.set("turbo_reflex",JSON.stringify(i)),n.src=d.toString()}catch(i){console.error("TurboReflex encountered an unexpected error!",{element:t,frameId:r,frame:n,frameSrc:s,target:e.target},i),o.dispatch(o.error,t||document,{element:t,frameId:r,frame:n,frameSrc:s,error:i})}}p(A);f("change",["input","select","textarea"]);f("submit",["form"]);f("click",["*"]);var M={registerEvent:f,logRegisteredEvents:R,logLifecycleEventNames:o.logEventNames};export{M as default};
//# sourceMappingURL=turbo_reflex.min.js.map
