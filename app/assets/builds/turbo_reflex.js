var l={beforeStart:"turbo-reflex:before-start",start:"turbo-reflex:start",finish:"turbo-reflex:finish",error:"turbo-reflex:error",missingFrameId:"turbo-reflex:missing-frame-id",missingFrame:"turbo-reflex:missing-frame",missingFrameSrc:"turbo-reflex:missing-frame-src"};function k(e,t=document,r={}){let n=new CustomEvent(e,{detail:r,cancelable:!0,bubbles:!0});t.dispatchEvent(n)}function w(){Object.values(l).forEach(e=>console.log(e))}var o={...l,dispatch:k,logEventNames:w};var d={};addEventListener("turbo:before-fetch-response",e=>{let t=e.target;d[t.id]=t.src;let{turboReflexActive:r,turboReflexElementId:n}=t.dataset;if(!r)return;let s=document.getElementById(n);delete t.dataset.turboReflexActive,delete t.dataset.turboReflexElementId,o.dispatch(o.finish,s||document,{frame:t,element:s||"Unknown! Missing id attribute."})});addEventListener("turbo:frame-load",e=>{let t=e.target;t.dataset.turboReflexSrc=d[t.id]||t.src||t.dataset.turboReflexSrc,delete d[t.id]});var i={get turboReflex(){return document.getElementById("turbo-reflex")},get turboReflexToken(){return document.getElementById("turbo-reflex-token")}};function m(e){return e.closest("[data-turbo-reflex]")}function F(e){return e.closest("turbo-frame")}function b(e){let t=e.dataset.turboFrame;if(!t){let r=F(e);r&&(t=r.id)}return t}function g(e){let t=document.getElementById(e);return t||(console.error(`The frame '${e}' does not exist!`),o.dispatch(o.missingFrame,document,{id:e})),t}function x(e){let t=e.dataset.turboReflexSrc||e.src;return t||(console.error(`The the 'src' for <turbo-frame id='${e.id}'> is unknown!`,"TurboReflex uses 'src' to (re)render frame content after the reflex is invoked.","Please set the 'src' or 'data-turbo-reflex-src' attribute on the <turbo-frame> element.",e),o.dispatch(o.missingFrameSrc,e,{frame:e})),t}function T(e,t={}){if(e.tagName.toLowerCase()!=="select")return t.value=e.value;if(!e.multiple)return t.value=e.options[e.selectedIndex].value;t.values=Array.from(e.options).reduce((r,n)=>(n.selected&&r.push(n.value),r),[])}function v(e){let t=Array.from(e.attributes).reduce((r,n)=>(r[n.name]=n.value,r),{});return t.tag=e.tagName,t.checked=e.checked,t.disabled=e.disabled,T(e,t),t}var u={},E;function h(e){E=e}function c(e,t){u[e]=t,document.addEventListener(e,E,!0)}function p(e,t){return t=t.toLowerCase(),u[e].includes(t)||!Object.values(u).flat().includes(t)&&u[e].includes("*")}function R(){console.log(u)}addEventListener("turbo:before-fetch-request",e=>{if(e.target!==i.turboReflex.frame)return;let{fetchOptions:r}=e.detail;r.headers["TurboReflex-Token"]=i.turboReflexToken.getAttribute("content");debugger});function L(e){let t=document.createElement("a");return t.href=e,new URL(t)}function S(e,t){let r=x(e);if(!r)return;let n=L(r);n.searchParams.set("turbo_reflex",JSON.stringify(t)),e.dataset.turboReflexActive=!0,e.src=n.toString()}function A(e){let t=L(window.location.href);t.searchParams.set("turbo_reflex",JSON.stringify(e));let r=new XMLHttpRequest;r.open("GET",t,!0),r.setRequestHeader("TurboReflex-Token",i.turboReflexToken.getAttribute("content")),r.addEventListener("load",()=>{let n=r.responseText.match(/<\s*turbo-stream.*<\/turbo-stream\s*>/i);document.body.insertAdjacentHTML("beforeend",n)}),r.addEventListener("error",()=>{debugger}),r.addEventListener("abort",()=>{debugger}),r.send()}function I(e){let t={};try{let r=m(e.target);if(!r||!p(e.type,r.tagName))return;o.dispatch(o.beforeStart,r);let n=b(r),s;if(n&&(s=g(n),!s))return;let a="window";s&&(a="frame"),r.tagName.toLowerCase()==="form"&&(a="form");let f={driver:a,element:v(r)};t={...f,frame:s,element:r};let y={busy:!0,driver:a,reflex:r.dataset.turboReflex};switch(i.turboReflex.frame=s,Object.assign(i.turboReflex.dataset,y),o.dispatch(o.start,r,t),a){case"frame":return e.preventDefault(),S(s,f);case"form":debugger;break;case"window":return e.preventDefault(),A(f)}}catch(r){t.error=r,console.error("TurboReflex encountered an unexpected error!",t),o.dispatch(o.error,element||document,t)}}h(I);c("change",["input","select","textarea"]);c("submit",["form"]);c("click",["*"]);var _={registerEvent:c,logRegisteredEvents:R,logLifecycleEventNames:o.logEventNames};export{_ as default};
//# sourceMappingURL=turbo_reflex.js.map
