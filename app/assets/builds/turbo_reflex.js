var l={beforeStart:"turbo-reflex:before-start",start:"turbo-reflex:start",finish:"turbo-reflex:finish",error:"turbo-reflex:error",missingFrameId:"turbo-reflex:missing-frame-id",missingFrame:"turbo-reflex:missing-frame",missingFrameSrc:"turbo-reflex:missing-frame-src"};function L(t,e=document,r={}){let n=new CustomEvent(t,{detail:r,cancelable:!0,bubbles:!0});e.dispatchEvent(n)}function k(){Object.values(l).forEach(t=>console.log(t))}var o={...l,dispatch:L,logEventNames:k};var f={};addEventListener("turbo:before-fetch-response",t=>{let e=t.target;f[e.id]=e.src;let{turboReflexActive:r,turboReflexElementId:n}=e.dataset;if(!r)return;let s=document.getElementById(n);delete e.dataset.turboReflexActive,delete e.dataset.turboReflexElementId,o.dispatch(o.finish,s||document,{frame:e,element:s||"Unknown! Missing id attribute."})});addEventListener("turbo:frame-load",t=>{let e=t.target;e.dataset.turboReflexSrc=f[e.id]||e.src||e.dataset.turboReflexSrc,delete f[e.id]});var c={get turboReflex(){return document.getElementById("turbo-reflex")},get turboReflexToken(){return document.getElementById("turbo-reflex-token")}};function m(t){return t.closest("[data-turbo-reflex]")}function y(t){return t.closest("turbo-frame")}function b(t){let e=t.dataset.turboFrame;if(!e){let r=y(t);r&&(e=r.id)}return e}function g(t){let e=document.getElementById(t);return e||(console.error(`The frame '${t}' does not exist!`),o.dispatch(o.missingFrame,document,{id:t})),e}function w(t,e={}){if(t.tagName.toLowerCase()!=="select")return e.value=t.value;if(!t.multiple)return e.value=t.options[t.selectedIndex].value;e.values=Array.from(t.options).reduce((r,n)=>(n.selected&&r.push(n.value),r),[])}function x(t){let e=Array.from(t.attributes).reduce((r,n)=>(r[n.name]=n.value,r),{});return e.tag=t.tagName,e.checked=t.checked,e.disabled=t.disabled,w(t,e),e}var a={},v;function E(t){v=t}function u(t,e){a[t]=e,document.addEventListener(t,v,!0)}function h(t,e){return e=e.toLowerCase(),a[t].includes(e)||!Object.values(a).flat().includes(e)&&a[t].includes("*")}function p(){console.log(a)}addEventListener("turbo:before-fetch-request",t=>{let e=t.target,{turboReflexActive:r}=e.dataset;if(!r)return;let{fetchOptions:n}=t.detail;n.headers["TurboReflex-Token"]=c.turboReflexToken.getAttribute("content")});function F(t){let e=document.createElement("a");return e.href=t,new URL(e)}function T(t){let e=F(window.location.href);e.searchParams.set("turbo_reflex",JSON.stringify(t));let r=new XMLHttpRequest;r.open("GET",e,!0),r.setRequestHeader("TurboReflex-Token",c.turboReflexToken.getAttribute("content")),r.addEventListener("load",()=>{let n=r.responseText.match(/<\s*turbo-stream.*<\/turbo-stream\s*>/i);document.body.insertAdjacentHTML("beforeend",n)}),r.addEventListener("error",()=>{debugger}),r.addEventListener("abort",()=>{debugger}),r.send()}function S(t){let e={};try{let r=m(t.target);if(!r||!h(t.type,r.tagName))return;o.dispatch(o.beforeStart,r);let n=b(r),s;if(n&&(s=g(n),!s))return;let i="window";s&&(i="frame"),r.tagName.toLowerCase()==="form"&&(i="form");let d={driver:i,element:x(r)};e={...d,frame:s,element:r};let R={busy:!0,driver:i,reflex:r.dataset.turboReflex};switch(Object.assign(c.turboReflex.dataset,R),o.dispatch(o.start,r,e),i){case"frame":t.preventDefault();debugger;break;case"form":debugger;break;case"window":return t.preventDefault(),T(d)}}catch(r){e.error=r,console.error("TurboReflex encountered an unexpected error!",e),o.dispatch(o.error,element||document,e)}}E(S);u("change",["input","select","textarea"]);u("submit",["form"]);u("click",["*"]);var U={registerEvent:u,logRegisteredEvents:p,logLifecycleEventNames:o.logEventNames};export{U as default};
//# sourceMappingURL=turbo_reflex.js.map
