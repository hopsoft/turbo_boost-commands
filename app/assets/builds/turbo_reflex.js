var m={beforeStart:"turbo-reflex:before-start",start:"turbo-reflex:start",finish:"turbo-reflex:finish",error:"turbo-reflex:error",missingFrameId:"turbo-reflex:missing-frame-id",missingFrame:"turbo-reflex:missing-frame",missingFrameSrc:"turbo-reflex:missing-frame-src"};function y(e,t=document,r={}){let n=new CustomEvent(e,{detail:r,cancelable:!0,bubbles:!0});t.dispatchEvent(n)}function w(){Object.values(m).forEach(e=>console.log(e))}var o={...m,dispatch:y,logEventNames:w};var l={};addEventListener("turbo:before-fetch-response",e=>{let t=e.target;l[t.id]=t.src;let{turboReflexActive:r,turboReflexElementId:n}=t.dataset;if(!r)return;let s=document.getElementById(n);delete t.dataset.turboReflexActive,delete t.dataset.turboReflexElementId,o.dispatch(o.finish,s||document,{frame:t,element:s||"Unknown! Missing id attribute."})});addEventListener("turbo:frame-load",e=>{let t=e.target;t.dataset.turboReflexSrc=l[t.id]||t.src||t.dataset.turboReflexSrc,delete l[t.id]});var c={get element(){return document.getElementById("turbo-reflex")},get token(){return document.getElementById("turbo-reflex").getAttribute("content")}};function b(e){return e.closest("[data-turbo-reflex]")}function F(e){return e.closest("turbo-frame")}function g(e){let t=e.dataset.turboFrame;if(!t){let r=F(e);r&&(t=r.id)}return t}function x(e){let t=document.getElementById(e);return t||(console.error(`The frame '${e}' does not exist!`),o.dispatch(o.missingFrame,document,{id:e})),t}function v(e){let t=e.dataset.turboReflexSrc||e.src;return t||(console.error(`The the 'src' for <turbo-frame id='${e.id}'> is unknown!`,"TurboReflex uses 'src' to (re)render frame content after the reflex is invoked.","Please set the 'src' or 'data-turbo-reflex-src' attribute on the <turbo-frame> element.",e),o.dispatch(o.missingFrameSrc,e,{frame:e})),t}function S(e,t={}){if(e.tagName.toLowerCase()!=="select")return t.value=e.value;if(!e.multiple)return t.value=e.options[e.selectedIndex].value;t.values=Array.from(e.options).reduce((r,n)=>(n.selected&&r.push(n.value),r),[])}function h(e){let t=Array.from(e.attributes).reduce((r,n)=>(r[n.name]=n.value,r),{});return t.tag=e.tagName,t.checked=e.checked,t.disabled=e.disabled,S(e,t),t}var u={},p;function E(e){p=e}function f(e,t){u[e]=t,document.addEventListener(e,p,!0)}function R(e,t){return t=t.toLowerCase(),u[e].includes(t)||!Object.values(u).flat().includes(t)&&u[e].includes("*")}function L(){console.log(u)}addEventListener("turbo:before-fetch-request",e=>{if(e.target!==c.element.frame)return;let{fetchOptions:r}=e.detail;r.headers["TurboReflex-Token"]=c.token});function k(e){let t=document.createElement("a");return t.href=e,new URL(t)}function I(e,t){let r=v(e);if(!r)return;let n=k(r);n.searchParams.set("turbo_reflex",JSON.stringify(t)),e.dataset.turboReflexActive=!0,e.src=n.toString()}function T(e,t={}){t.token=c.token;let r=document.createElement("input");r.type="hidden",r.name="turbo_reflex",r.value=JSON.stringify(t),e.appendChild(r)}function A(e){let t=k(window.location.href);t.searchParams.set("turbo_reflex",JSON.stringify(e));let r=new XMLHttpRequest;r.open("GET",t,!0),r.setRequestHeader("TurboReflex-Token",c.token),r.addEventListener("load",()=>{let n="<turbo-stream",s="</turbo-stream>",i=r.responseText.indexOf(n),a=r.responseText.lastIndexOf(s);if(i>=0&&a>=0){let d=r.responseText.slice(i,a+s.length);document.body.insertAdjacentHTML("beforeend",d)}}),r.addEventListener("error",()=>{debugger}),r.addEventListener("abort",()=>{debugger}),r.send()}function C(e){let t={};try{let r=b(e.target);if(!r||!R(e.type,r.tagName))return;o.dispatch(o.beforeStart,r);let n=g(r),s;if(n&&(s=x(n),!s))return;let i="window";s&&(i="frame"),r.tagName.toLowerCase()==="form"&&(i="form");let a={driver:i,element:h(r)};t={...a,frame:s,element:r};let d={busy:!0,driver:i,reflex:r.dataset.turboReflex};switch(c.element.frame=s,Object.assign(c.element.dataset,d),o.dispatch(o.start,r,t),i!=="form"&&e.preventDefault(),i){case"frame":I(s,a);break;case"form":T(r,a);break;case"window":A(a);break}}catch(r){t.error=r,console.error("TurboReflex encountered an unexpected error!",t),o.dispatch(o.error,element||document,t)}}E(C);f("change",["input","select","textarea"]);f("submit",["form"]);f("click",["*"]);var $={registerEvent:f,logRegisteredEvents:L,logLifecycleEventNames:o.logEventNames};export{$ as default};
//# sourceMappingURL=turbo_reflex.js.map
